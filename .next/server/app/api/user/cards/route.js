"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/user/cards/route";
exports.ids = ["app/api/user/cards/route"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fuser%2Fcards%2Froute&page=%2Fapi%2Fuser%2Fcards%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fuser%2Fcards%2Froute.ts&appDir=C%3A%5CUsers%5CAdmin%5CDesktop%5Cyeka%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CAdmin%5CDesktop%5Cyeka&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fuser%2Fcards%2Froute&page=%2Fapi%2Fuser%2Fcards%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fuser%2Fcards%2Froute.ts&appDir=C%3A%5CUsers%5CAdmin%5CDesktop%5Cyeka%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CAdmin%5CDesktop%5Cyeka&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_Admin_Desktop_yeka_app_api_user_cards_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/user/cards/route.ts */ \"(rsc)/./app/api/user/cards/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/user/cards/route\",\n        pathname: \"/api/user/cards\",\n        filename: \"route\",\n        bundlePath: \"app/api/user/cards/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\Admin\\\\Desktop\\\\yeka\\\\app\\\\api\\\\user\\\\cards\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_Admin_Desktop_yeka_app_api_user_cards_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/user/cards/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZ1c2VyJTJGY2FyZHMlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnVzZXIlMkZjYXJkcyUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnVzZXIlMkZjYXJkcyUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNBZG1pbiU1Q0Rlc2t0b3AlNUN5ZWthJTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1DJTNBJTVDVXNlcnMlNUNBZG1pbiU1Q0Rlc2t0b3AlNUN5ZWthJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNnQjtBQUM3RjtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL2NhcmR2ZWxhLz83NDIyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkM6XFxcXFVzZXJzXFxcXEFkbWluXFxcXERlc2t0b3BcXFxceWVrYVxcXFxhcHBcXFxcYXBpXFxcXHVzZXJcXFxcY2FyZHNcXFxccm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3VzZXIvY2FyZHMvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS91c2VyL2NhcmRzXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS91c2VyL2NhcmRzL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiQzpcXFxcVXNlcnNcXFxcQWRtaW5cXFxcRGVza3RvcFxcXFx5ZWthXFxcXGFwcFxcXFxhcGlcXFxcdXNlclxcXFxjYXJkc1xcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvdXNlci9jYXJkcy9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fuser%2Fcards%2Froute&page=%2Fapi%2Fuser%2Fcards%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fuser%2Fcards%2Froute.ts&appDir=C%3A%5CUsers%5CAdmin%5CDesktop%5Cyeka%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CAdmin%5CDesktop%5Cyeka&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/user/cards/route.ts":
/*!*************************************!*\
  !*** ./app/api/user/cards/route.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _src_lib_db__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../src/lib/db */ \"(rsc)/./src/lib/db.ts\");\n/* harmony import */ var _src_lib_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../src/lib/auth */ \"(rsc)/./src/lib/auth.ts\");\n/* harmony import */ var _src_lib_gsalary__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../src/lib/gsalary */ \"(rsc)/./src/lib/gsalary.ts\");\n\n\n\n\n// 获取用户的卡片列表\nasync function GET(request) {\n    try {\n        const token = (0,_src_lib_auth__WEBPACK_IMPORTED_MODULE_2__.getTokenFromRequest)(request);\n        if (!token) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"未授权\"\n            }, {\n                status: 401\n            });\n        }\n        const payload = (0,_src_lib_auth__WEBPACK_IMPORTED_MODULE_2__.verifyToken)(token);\n        if (!payload) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"无效的令牌\"\n            }, {\n                status: 401\n            });\n        }\n        const cards = await _src_lib_db__WEBPACK_IMPORTED_MODULE_1__.db.userCard.findMany({\n            where: {\n                userId: payload.userId\n            },\n            include: {\n                cardType: true\n            },\n            orderBy: {\n                createdAt: \"desc\"\n            }\n        });\n        // 同步上游余额（后台静默执行，不影响响应速度）\n        syncCardBalances(cards).catch((err)=>console.error(\"同步余额失败:\", err));\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            cards\n        });\n    } catch (error) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: error.message\n        }, {\n            status: 500\n        });\n    }\n}\n// 同步卡片余额和状态\nasync function syncCardBalances(cards) {\n    for (const card of cards){\n        if (!card.gsalaryCardId) continue;\n        try {\n            const detail = await (0,_src_lib_gsalary__WEBPACK_IMPORTED_MODULE_3__.getCardDetail)(card.gsalaryCardId);\n            const upstreamBalance = detail.available_balance || 0;\n            const upstreamStatus = detail.status === \"ACTIVE\" ? \"active\" : \"pending\";\n            // 提取卡号后四位\n            const maskCardNumber = detail.mask_card_number || \"\";\n            const cardNoLast4 = maskCardNumber.slice(-4) || card.cardNoLast4 || \"\";\n            // 检查是否需要更新\n            const needUpdate = card.balance !== upstreamBalance || card.status !== upstreamStatus || card.cardNoLast4 !== cardNoLast4;\n            if (needUpdate) {\n                await _src_lib_db__WEBPACK_IMPORTED_MODULE_1__.db.userCard.update({\n                    where: {\n                        id: card.id\n                    },\n                    data: {\n                        balance: upstreamBalance,\n                        status: upstreamStatus,\n                        cardNoLast4: cardNoLast4\n                    }\n                });\n                console.log(`[同步] 卡 ${card.id} 状态: ${card.status} -> ${upstreamStatus}, 余额: ${card.balance} -> ${upstreamBalance}`);\n            }\n        } catch (err) {\n            const msg = String(err?.message || err);\n            if (msg.includes(\"Invalid ip\") || msg.includes(\"Invalid IP\") || msg.includes(\"403\")) {\n                throw new Error(\"Invalid ip\");\n            }\n            console.error(`[同步] 卡 ${card.id} 失败:`, err);\n        }\n    }\n}\n// 申请开卡\nasync function POST(request) {\n    try {\n        const token = (0,_src_lib_auth__WEBPACK_IMPORTED_MODULE_2__.getTokenFromRequest)(request);\n        if (!token) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"未授权\"\n            }, {\n                status: 401\n            });\n        }\n        const payload = (0,_src_lib_auth__WEBPACK_IMPORTED_MODULE_2__.verifyToken)(token);\n        if (!payload) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"无效的令牌\"\n            }, {\n                status: 401\n            });\n        }\n        const body = await request.json();\n        const { cardTypeId, initialAmount = 0 } = body;\n        const user = await _src_lib_db__WEBPACK_IMPORTED_MODULE_1__.db.user.findUnique({\n            where: {\n                id: payload.userId\n            }\n        });\n        if (!user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"用户不存在\"\n            }, {\n                status: 404\n            });\n        }\n        const cardType = await _src_lib_db__WEBPACK_IMPORTED_MODULE_1__.db.cardType.findUnique({\n            where: {\n                id: cardTypeId\n            }\n        });\n        if (!cardType || !cardType.isActive) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"卡片类型不可用\"\n            }, {\n                status: 400\n            });\n        }\n        // 计算费用\n        const rechargeFee = initialAmount * (cardType.rechargeFee / 100);\n        const totalCost = cardType.openFee + initialAmount + rechargeFee;\n        if (user.balance < totalCost) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: `余额不足，需要 $${totalCost.toFixed(2)}，当前余额 $${user.balance.toFixed(2)}`\n            }, {\n                status: 400\n            });\n        }\n        // 调用上游API开卡（使用默认持卡人）\n        let applyResult;\n        try {\n            applyResult = await (0,_src_lib_gsalary__WEBPACK_IMPORTED_MODULE_3__.quickApplyCard)({\n                product_code: cardType.cardBin,\n                init_balance: Math.round(initialAmount * 100)\n            });\n        } catch (err) {\n            console.error(\"开卡调用失败:\", err);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: `开卡失败: ${err.message}`\n            }, {\n                status: 502\n            });\n        }\n        console.log(\"开卡结果:\", applyResult);\n        // 提取卡号后四位\n        const maskCardNumber = applyResult.mask_card_number || \"\";\n        const cardNoLast4 = maskCardNumber.slice(-4) || \"\";\n        // 确定卡片状态\n        const cardStatus = applyResult.status === \"ACTIVE\" ? \"active\" : \"pending\";\n        // 扣除用户余额\n        await _src_lib_db__WEBPACK_IMPORTED_MODULE_1__.db.user.update({\n            where: {\n                id: payload.userId\n            },\n            data: {\n                balance: {\n                    decrement: totalCost\n                }\n            }\n        });\n        // 创建卡片记录\n        const userCard = await _src_lib_db__WEBPACK_IMPORTED_MODULE_1__.db.userCard.create({\n            data: {\n                userId: payload.userId,\n                cardTypeId: cardType.id,\n                gsalaryCardId: applyResult.card_id || null,\n                cardNoLast4: cardNoLast4,\n                status: cardStatus,\n                balance: initialAmount,\n                openFee: cardType.openFee\n            },\n            include: {\n                cardType: true\n            }\n        });\n        // 记录交易\n        await _src_lib_db__WEBPACK_IMPORTED_MODULE_1__.db.transaction.create({\n            data: {\n                userId: payload.userId,\n                type: \"purchase\",\n                amount: -totalCost,\n                status: \"completed\"\n            }\n        });\n        // 轮询上游卡列表，尝试找到对应的 card_id\n        let upstreamCard = null;\n        const holderId = process.env.GSALARY_DEFAULT_CARD_HOLDER_ID || undefined;\n        if (applyResult && applyResult.request_id && holderId) {\n            const maxAttempts = 15;\n            for(let attempt = 0; attempt < maxAttempts; attempt++){\n                try {\n                    await new Promise((res)=>setTimeout(res, 1500));\n                    const cardsRes = await (0,_src_lib_gsalary__WEBPACK_IMPORTED_MODULE_3__.getCards)({\n                        page: 1,\n                        limit: 100,\n                        card_holder_id: holderId\n                    });\n                    // 打印完整的 API 响应结构\n                    console.log(\"[API原始响应]\", JSON.stringify(cardsRes, null, 2));\n                    // 提取卡片数组（兼容多种响应格式）\n                    let upstreamCards = [];\n                    if (Array.isArray(cardsRes)) {\n                        upstreamCards = cardsRes;\n                    } else if (cardsRes?.cards && Array.isArray(cardsRes.cards)) {\n                        upstreamCards = cardsRes.cards;\n                    } else if (cardsRes?.list && Array.isArray(cardsRes.list)) {\n                        upstreamCards = cardsRes.list;\n                    } else if (cardsRes?.data && Array.isArray(cardsRes.data)) {\n                        upstreamCards = cardsRes.data;\n                    }\n                    console.log(`[轮询 ${attempt + 1}/${maxAttempts}] 获取到 ${upstreamCards.length} 张卡`);\n                    // 打印所有卡片的基本信息\n                    upstreamCards.forEach((c, idx)=>{\n                        console.log(`[卡片${idx}]`, {\n                            card_id: c.card_id,\n                            id: c.id,\n                            request_id: c.request_id,\n                            card_no: c.card_no,\n                            pan: c.pan,\n                            create_time: c.create_time,\n                            status: c.status\n                        });\n                    });\n                    // 打印第一张卡的完整结构\n                    if (attempt === 0 && upstreamCards.length > 0) {\n                        console.log(\"[完整卡片结构]\", JSON.stringify(upstreamCards[0], null, 2));\n                    }\n                    // 寻找匹配的卡\n                    // 策略：按时间戳范围匹配（applyResult.create_time 应该是最新的卡的创建时间）\n                    upstreamCard = upstreamCards.find((c)=>{\n                        if (!c) return false;\n                        // 策略 1: 按 card_id 直接判断（如果 applyResult 包含 card_id）\n                        if (applyResult.card_id && c.card_id === applyResult.card_id) {\n                            console.log(\"[匹配成功] 按 card_id 精确匹配\");\n                            return true;\n                        }\n                        // 策略 2: 按创建时间匹配（applyResult.create_time 是 ISO 格式）\n                        // 由于上游返回的卡片没有 create_time，改用：找状态为 PENDING 的最新卡\n                        if (c.status === \"PENDING\") {\n                            console.log(\"[匹配成功] 按 PENDING 状态匹配（新开的卡）\");\n                            return true;\n                        }\n                        return false;\n                    });\n                    // 如果还是没找到，取第一张（最新的）\n                    if (!upstreamCard && upstreamCards.length > 0) {\n                        console.log(\"[启发式匹配] 找不到 PENDING 卡，使用最近的卡\");\n                        upstreamCard = upstreamCards[0];\n                    }\n                    if (upstreamCard) {\n                        console.log(\"[匹配成功]\", {\n                            card_id: upstreamCard.card_id,\n                            status: upstreamCard.status,\n                            mask_card_number: upstreamCard.mask_card_number\n                        });\n                        break;\n                    }\n                } catch (err) {\n                    console.warn(`[轮询失败 ${attempt + 1}/${maxAttempts}]`, err?.message || err);\n                }\n            }\n        }\n        // 如果找到了上游卡信息，更新本地记录\n        if (upstreamCard && userCard) {\n            try {\n                // 注意：mask_card_number 是掩码卡号如 \"456599******7671\"\n                // 需要直接用最后4位，而不是提取 card_id 的最后4位\n                let last4 = null;\n                if (upstreamCard.mask_card_number) {\n                    // 从掩码卡号提取最后4位：456599******7671 -> 7671\n                    const matches = upstreamCard.mask_card_number.match(/(\\d{4})$/);\n                    last4 = matches ? matches[1] : null;\n                }\n                console.log(\"[同步] 提取卡号:\", {\n                    mask_card_number: upstreamCard.mask_card_number,\n                    last4\n                });\n                // 获取卡的真实状态（PENDING 的卡需要等待激活）\n                const cardStatus = upstreamCard.status?.toLowerCase() || \"pending\";\n                await _src_lib_db__WEBPACK_IMPORTED_MODULE_1__.db.userCard.update({\n                    where: {\n                        id: userCard.id\n                    },\n                    data: {\n                        gsalaryCardId: upstreamCard.card_id || null,\n                        cardNoLast4: last4,\n                        status: cardStatus === \"pending\" ? \"pending\" : \"active\"\n                    }\n                });\n                console.log(\"[同步完成] 卡片状态:\", cardStatus, \"后四位:\", last4);\n            } catch (err) {\n                console.error(\"[同步失败]\", err);\n            }\n        } else {\n            console.log(\"[同步] 未找到匹配的卡片或 upstreamCard 为空\");\n            console.log(\"[调试信息]\", {\n                upstreamCard: !!upstreamCard,\n                userCard: !!userCard,\n                applyResult\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            card: userCard,\n            message: applyResult.status === \"SUCCESS\" ? \"开卡成功\" : \"开卡申请已提交，等待处理\"\n        });\n    } catch (error) {\n        console.error(\"开卡失败:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: error.message\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2FyZHZlbGEvLi9hcHAvYXBpL3VzZXIvY2FyZHMvcm91dGUudHM/ZGE4MSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBkYiB9IGZyb20gJy4uLy4uLy4uLy4uL3NyYy9saWIvZGInO1xyXG5pbXBvcnQgeyB2ZXJpZnlUb2tlbiwgZ2V0VG9rZW5Gcm9tUmVxdWVzdCB9IGZyb20gJy4uLy4uLy4uLy4uL3NyYy9saWIvYXV0aCc7XHJcbmltcG9ydCB7IHF1aWNrQXBwbHlDYXJkLCBnZXRDYXJkcywgZ2V0Q2FyZERldGFpbCB9IGZyb20gJy4uLy4uLy4uLy4uL3NyYy9saWIvZ3NhbGFyeSc7XHJcblxyXG4vLyDojrflj5bnlKjmiLfnmoTljaHniYfliJfooahcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB0b2tlbiA9IGdldFRva2VuRnJvbVJlcXVlc3QocmVxdWVzdCk7XHJcbiAgICBpZiAoIXRva2VuKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAn5pyq5o6I5p2DJyB9LCB7IHN0YXR1czogNDAxIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHBheWxvYWQgPSB2ZXJpZnlUb2tlbih0b2tlbik7XHJcbiAgICBpZiAoIXBheWxvYWQpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICfml6DmlYjnmoTku6TniYwnIH0sIHsgc3RhdHVzOiA0MDEgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY2FyZHMgPSBhd2FpdCBkYi51c2VyQ2FyZC5maW5kTWFueSh7XHJcbiAgICAgIHdoZXJlOiB7IHVzZXJJZDogcGF5bG9hZC51c2VySWQgfSxcclxuICAgICAgaW5jbHVkZTogeyBjYXJkVHlwZTogdHJ1ZSB9LFxyXG4gICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDlkIzmraXkuIrmuLjkvZnpop3vvIjlkI7lj7DpnZnpu5jmiafooYzvvIzkuI3lvbHlk43lk43lupTpgJ/luqbvvIlcclxuICAgIHN5bmNDYXJkQmFsYW5jZXMoY2FyZHMpLmNhdGNoKGVyciA9PiBjb25zb2xlLmVycm9yKCflkIzmraXkvZnpop3lpLHotKU6JywgZXJyKSk7XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgY2FyZHMgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSwgeyBzdGF0dXM6IDUwMCB9KTtcclxuICB9XHJcbn1cclxuXHJcbi8vIOWQjOatpeWNoeeJh+S9memineWSjOeKtuaAgVxyXG5hc3luYyBmdW5jdGlvbiBzeW5jQ2FyZEJhbGFuY2VzKGNhcmRzOiBhbnlbXSkge1xyXG4gIGZvciAoY29uc3QgY2FyZCBvZiBjYXJkcykge1xyXG4gICAgaWYgKCFjYXJkLmdzYWxhcnlDYXJkSWQpIGNvbnRpbnVlO1xyXG4gICAgXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBkZXRhaWwgPSBhd2FpdCBnZXRDYXJkRGV0YWlsKGNhcmQuZ3NhbGFyeUNhcmRJZCk7XHJcbiAgICAgIGNvbnN0IHVwc3RyZWFtQmFsYW5jZSA9IGRldGFpbC5hdmFpbGFibGVfYmFsYW5jZSB8fCAwO1xyXG4gICAgICBjb25zdCB1cHN0cmVhbVN0YXR1cyA9IGRldGFpbC5zdGF0dXMgPT09ICdBQ1RJVkUnID8gJ2FjdGl2ZScgOiAncGVuZGluZyc7XHJcbiAgICAgIFxyXG4gICAgICAvLyDmj5Dlj5bljaHlj7flkI7lm5vkvY1cclxuICAgICAgY29uc3QgbWFza0NhcmROdW1iZXIgPSBkZXRhaWwubWFza19jYXJkX251bWJlciB8fCAnJztcclxuICAgICAgY29uc3QgY2FyZE5vTGFzdDQgPSBtYXNrQ2FyZE51bWJlci5zbGljZSgtNCkgfHwgY2FyZC5jYXJkTm9MYXN0NCB8fCAnJztcclxuICAgICAgXHJcbiAgICAgIC8vIOajgOafpeaYr+WQpumcgOimgeabtOaWsFxyXG4gICAgICBjb25zdCBuZWVkVXBkYXRlID0gXHJcbiAgICAgICAgY2FyZC5iYWxhbmNlICE9PSB1cHN0cmVhbUJhbGFuY2UgfHwgXHJcbiAgICAgICAgY2FyZC5zdGF0dXMgIT09IHVwc3RyZWFtU3RhdHVzIHx8XHJcbiAgICAgICAgY2FyZC5jYXJkTm9MYXN0NCAhPT0gY2FyZE5vTGFzdDQ7XHJcbiAgICAgIFxyXG4gICAgICBpZiAobmVlZFVwZGF0ZSkge1xyXG4gICAgICAgIGF3YWl0IGRiLnVzZXJDYXJkLnVwZGF0ZSh7XHJcbiAgICAgICAgICB3aGVyZTogeyBpZDogY2FyZC5pZCB9LFxyXG4gICAgICAgICAgZGF0YTogeyBcclxuICAgICAgICAgICAgYmFsYW5jZTogdXBzdHJlYW1CYWxhbmNlLFxyXG4gICAgICAgICAgICBzdGF0dXM6IHVwc3RyZWFtU3RhdHVzLFxyXG4gICAgICAgICAgICBjYXJkTm9MYXN0NDogY2FyZE5vTGFzdDQsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBb5ZCM5q2lXSDljaEgJHtjYXJkLmlkfSDnirbmgIE6ICR7Y2FyZC5zdGF0dXN9IC0+ICR7dXBzdHJlYW1TdGF0dXN9LCDkvZnpop06ICR7Y2FyZC5iYWxhbmNlfSAtPiAke3Vwc3RyZWFtQmFsYW5jZX1gKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgICAgY29uc3QgbXNnID0gU3RyaW5nKGVycj8ubWVzc2FnZSB8fCBlcnIpO1xyXG4gICAgICBpZiAobXNnLmluY2x1ZGVzKCdJbnZhbGlkIGlwJykgfHwgbXNnLmluY2x1ZGVzKCdJbnZhbGlkIElQJykgfHwgbXNnLmluY2x1ZGVzKCc0MDMnKSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBpcCcpO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFvlkIzmraVdIOWNoSAke2NhcmQuaWR9IOWksei0pTpgLCBlcnIpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuLy8g55Sz6K+35byA5Y2hXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHRva2VuID0gZ2V0VG9rZW5Gcm9tUmVxdWVzdChyZXF1ZXN0KTtcclxuICAgIGlmICghdG9rZW4pIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICfmnKrmjojmnYMnIH0sIHsgc3RhdHVzOiA0MDEgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcGF5bG9hZCA9IHZlcmlmeVRva2VuKHRva2VuKTtcclxuICAgIGlmICghcGF5bG9hZCkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ+aXoOaViOeahOS7pOeJjCcgfSwgeyBzdGF0dXM6IDQwMSB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XHJcbiAgICBjb25zdCB7IGNhcmRUeXBlSWQsIGluaXRpYWxBbW91bnQgPSAwIH0gPSBib2R5O1xyXG5cclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBkYi51c2VyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZDogcGF5bG9hZC51c2VySWQgfSB9KTtcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ+eUqOaIt+S4jeWtmOWcqCcgfSwgeyBzdGF0dXM6IDQwNCB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjYXJkVHlwZSA9IGF3YWl0IGRiLmNhcmRUeXBlLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZDogY2FyZFR5cGVJZCB9IH0pO1xyXG4gICAgaWYgKCFjYXJkVHlwZSB8fCAhY2FyZFR5cGUuaXNBY3RpdmUpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICfljaHniYfnsbvlnovkuI3lj6/nlKgnIH0sIHsgc3RhdHVzOiA0MDAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g6K6h566X6LS555SoXHJcbiAgICBjb25zdCByZWNoYXJnZUZlZSA9IGluaXRpYWxBbW91bnQgKiAoY2FyZFR5cGUucmVjaGFyZ2VGZWUgLyAxMDApO1xyXG4gICAgY29uc3QgdG90YWxDb3N0ID0gY2FyZFR5cGUub3BlbkZlZSArIGluaXRpYWxBbW91bnQgKyByZWNoYXJnZUZlZTtcclxuXHJcbiAgICBpZiAodXNlci5iYWxhbmNlIDwgdG90YWxDb3N0KSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgICAgZXJyb3I6IGDkvZnpop3kuI3otrPvvIzpnIDopoEgJCR7dG90YWxDb3N0LnRvRml4ZWQoMil977yM5b2T5YmN5L2Z6aKdICQke3VzZXIuYmFsYW5jZS50b0ZpeGVkKDIpfWBcclxuICAgICAgfSwgeyBzdGF0dXM6IDQwMCB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDosIPnlKjkuIrmuLhBUEnlvIDljaHvvIjkvb/nlKjpu5jorqTmjIHljaHkurrvvIlcclxuICAgIGxldCBhcHBseVJlc3VsdDtcclxuICAgIHRyeSB7XHJcbiAgICAgIGFwcGx5UmVzdWx0ID0gYXdhaXQgcXVpY2tBcHBseUNhcmQoe1xyXG4gICAgICAgIHByb2R1Y3RfY29kZTogY2FyZFR5cGUuY2FyZEJpbixcclxuICAgICAgICBpbml0X2JhbGFuY2U6IE1hdGgucm91bmQoaW5pdGlhbEFtb3VudCAqIDEwMCksXHJcbiAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign5byA5Y2h6LCD55So5aSx6LSlOicsIGVycik7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBg5byA5Y2h5aSx6LSlOiAke2Vyci5tZXNzYWdlfWAgfSwgeyBzdGF0dXM6IDUwMiB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zb2xlLmxvZygn5byA5Y2h57uT5p6cOicsIGFwcGx5UmVzdWx0KTtcclxuXHJcbiAgICAvLyDmj5Dlj5bljaHlj7flkI7lm5vkvY1cclxuICAgIGNvbnN0IG1hc2tDYXJkTnVtYmVyID0gYXBwbHlSZXN1bHQubWFza19jYXJkX251bWJlciB8fCAnJztcclxuICAgIGNvbnN0IGNhcmROb0xhc3Q0ID0gbWFza0NhcmROdW1iZXIuc2xpY2UoLTQpIHx8ICcnO1xyXG4gICAgXHJcbiAgICAvLyDnoa7lrprljaHniYfnirbmgIFcclxuICAgIGNvbnN0IGNhcmRTdGF0dXMgPSBhcHBseVJlc3VsdC5zdGF0dXMgPT09ICdBQ1RJVkUnID8gJ2FjdGl2ZScgOiAncGVuZGluZyc7XHJcblxyXG4gICAgLy8g5omj6Zmk55So5oi35L2Z6aKdXHJcbiAgICBhd2FpdCBkYi51c2VyLnVwZGF0ZSh7XHJcbiAgICAgIHdoZXJlOiB7IGlkOiBwYXlsb2FkLnVzZXJJZCB9LFxyXG4gICAgICBkYXRhOiB7IGJhbGFuY2U6IHsgZGVjcmVtZW50OiB0b3RhbENvc3QgfSB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g5Yib5bu65Y2h54mH6K6w5b2VXHJcbiAgICBjb25zdCB1c2VyQ2FyZCA9IGF3YWl0IGRiLnVzZXJDYXJkLmNyZWF0ZSh7XHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICB1c2VySWQ6IHBheWxvYWQudXNlcklkLFxyXG4gICAgICAgIGNhcmRUeXBlSWQ6IGNhcmRUeXBlLmlkLFxyXG4gICAgICAgIGdzYWxhcnlDYXJkSWQ6IGFwcGx5UmVzdWx0LmNhcmRfaWQgfHwgbnVsbCxcclxuICAgICAgICBjYXJkTm9MYXN0NDogY2FyZE5vTGFzdDQsXHJcbiAgICAgICAgc3RhdHVzOiBjYXJkU3RhdHVzLFxyXG4gICAgICAgIGJhbGFuY2U6IGluaXRpYWxBbW91bnQsXHJcbiAgICAgICAgb3BlbkZlZTogY2FyZFR5cGUub3BlbkZlZSxcclxuICAgICAgfSxcclxuICAgICAgaW5jbHVkZTogeyBjYXJkVHlwZTogdHJ1ZSB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g6K6w5b2V5Lqk5piTXHJcbiAgICBhd2FpdCBkYi50cmFuc2FjdGlvbi5jcmVhdGUoe1xyXG4gICAgICBkYXRhOiB7XHJcbiAgICAgICAgdXNlcklkOiBwYXlsb2FkLnVzZXJJZCxcclxuICAgICAgICB0eXBlOiAncHVyY2hhc2UnLFxyXG4gICAgICAgIGFtb3VudDogLXRvdGFsQ29zdCxcclxuICAgICAgICBzdGF0dXM6ICdjb21wbGV0ZWQnLFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g6L2u6K+i5LiK5ri45Y2h5YiX6KGo77yM5bCd6K+V5om+5Yiw5a+55bqU55qEIGNhcmRfaWRcclxuICAgIGxldCB1cHN0cmVhbUNhcmQ6IGFueSA9IG51bGw7XHJcbiAgICBjb25zdCBob2xkZXJJZCA9IHByb2Nlc3MuZW52LkdTQUxBUllfREVGQVVMVF9DQVJEX0hPTERFUl9JRCB8fCB1bmRlZmluZWQ7XHJcbiAgICBpZiAoYXBwbHlSZXN1bHQgJiYgYXBwbHlSZXN1bHQucmVxdWVzdF9pZCAmJiBob2xkZXJJZCkge1xyXG4gICAgICBjb25zdCBtYXhBdHRlbXB0cyA9IDE1O1xyXG4gICAgICBmb3IgKGxldCBhdHRlbXB0ID0gMDsgYXR0ZW1wdCA8IG1heEF0dGVtcHRzOyBhdHRlbXB0KyspIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzID0+IHNldFRpbWVvdXQocmVzLCAxNTAwKSk7XHJcblxyXG4gICAgICAgICAgY29uc3QgY2FyZHNSZXMgPSBhd2FpdCBnZXRDYXJkcyh7IHBhZ2U6IDEsIGxpbWl0OiAxMDAsIGNhcmRfaG9sZGVyX2lkOiBob2xkZXJJZCB9KTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgLy8g5omT5Y2w5a6M5pW055qEIEFQSSDlk43lupTnu5PmnoRcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdbQVBJ5Y6f5aeL5ZON5bqUXScsIEpTT04uc3RyaW5naWZ5KGNhcmRzUmVzLCBudWxsLCAyKSk7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIOaPkOWPluWNoeeJh+aVsOe7hO+8iOWFvOWuueWkmuenjeWTjeW6lOagvOW8j++8iVxyXG4gICAgICAgICAgbGV0IHVwc3RyZWFtQ2FyZHM6IGFueVtdID0gW107XHJcbiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjYXJkc1JlcykpIHtcclxuICAgICAgICAgICAgdXBzdHJlYW1DYXJkcyA9IGNhcmRzUmVzO1xyXG4gICAgICAgICAgfSBlbHNlIGlmIChjYXJkc1Jlcz8uY2FyZHMgJiYgQXJyYXkuaXNBcnJheShjYXJkc1Jlcy5jYXJkcykpIHtcclxuICAgICAgICAgICAgdXBzdHJlYW1DYXJkcyA9IGNhcmRzUmVzLmNhcmRzO1xyXG4gICAgICAgICAgfSBlbHNlIGlmIChjYXJkc1Jlcz8ubGlzdCAmJiBBcnJheS5pc0FycmF5KGNhcmRzUmVzLmxpc3QpKSB7XHJcbiAgICAgICAgICAgIHVwc3RyZWFtQ2FyZHMgPSBjYXJkc1Jlcy5saXN0O1xyXG4gICAgICAgICAgfSBlbHNlIGlmIChjYXJkc1Jlcz8uZGF0YSAmJiBBcnJheS5pc0FycmF5KGNhcmRzUmVzLmRhdGEpKSB7XHJcbiAgICAgICAgICAgIHVwc3RyZWFtQ2FyZHMgPSBjYXJkc1Jlcy5kYXRhO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGNvbnNvbGUubG9nKGBb6L2u6K+iICR7YXR0ZW1wdCArIDF9LyR7bWF4QXR0ZW1wdHN9XSDojrflj5bliLAgJHt1cHN0cmVhbUNhcmRzLmxlbmd0aH0g5byg5Y2hYCk7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIOaJk+WNsOaJgOacieWNoeeJh+eahOWfuuacrOS/oeaBr1xyXG4gICAgICAgICAgdXBzdHJlYW1DYXJkcy5mb3JFYWNoKChjLCBpZHgpID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYFvljaHniYcke2lkeH1dYCwge1xyXG4gICAgICAgICAgICAgIGNhcmRfaWQ6IGMuY2FyZF9pZCxcclxuICAgICAgICAgICAgICBpZDogYy5pZCxcclxuICAgICAgICAgICAgICByZXF1ZXN0X2lkOiBjLnJlcXVlc3RfaWQsXHJcbiAgICAgICAgICAgICAgY2FyZF9ubzogYy5jYXJkX25vLFxyXG4gICAgICAgICAgICAgIHBhbjogYy5wYW4sXHJcbiAgICAgICAgICAgICAgY3JlYXRlX3RpbWU6IGMuY3JlYXRlX3RpbWUsXHJcbiAgICAgICAgICAgICAgc3RhdHVzOiBjLnN0YXR1cyxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgLy8g5omT5Y2w56ys5LiA5byg5Y2h55qE5a6M5pW057uT5p6EXHJcbiAgICAgICAgICBpZiAoYXR0ZW1wdCA9PT0gMCAmJiB1cHN0cmVhbUNhcmRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1vlrozmlbTljaHniYfnu5PmnoRdJywgSlNPTi5zdHJpbmdpZnkodXBzdHJlYW1DYXJkc1swXSwgbnVsbCwgMikpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIC8vIOWvu+aJvuWMuemFjeeahOWNoVxyXG4gICAgICAgICAgLy8g562W55Wl77ya5oyJ5pe26Ze05oiz6IyD5Zu05Yy56YWN77yIYXBwbHlSZXN1bHQuY3JlYXRlX3RpbWUg5bqU6K+l5piv5pyA5paw55qE5Y2h55qE5Yib5bu65pe26Ze077yJXHJcbiAgICAgICAgICB1cHN0cmVhbUNhcmQgPSB1cHN0cmVhbUNhcmRzLmZpbmQoKGM6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIWMpIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIOetlueVpSAxOiDmjIkgY2FyZF9pZCDnm7TmjqXliKTmlq3vvIjlpoLmnpwgYXBwbHlSZXN1bHQg5YyF5ZCrIGNhcmRfaWTvvIlcclxuICAgICAgICAgICAgaWYgKGFwcGx5UmVzdWx0LmNhcmRfaWQgJiYgYy5jYXJkX2lkID09PSBhcHBseVJlc3VsdC5jYXJkX2lkKSB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1vljLnphY3miJDlip9dIOaMiSBjYXJkX2lkIOeyvuehruWMuemFjScpO1xyXG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyDnrZbnlaUgMjog5oyJ5Yib5bu65pe26Ze05Yy56YWN77yIYXBwbHlSZXN1bHQuY3JlYXRlX3RpbWUg5pivIElTTyDmoLzlvI/vvIlcclxuICAgICAgICAgICAgLy8g55Sx5LqO5LiK5ri46L+U5Zue55qE5Y2h54mH5rKh5pyJIGNyZWF0ZV90aW1l77yM5pS555So77ya5om+54q25oCB5Li6IFBFTkRJTkcg55qE5pyA5paw5Y2hXHJcbiAgICAgICAgICAgIGlmIChjLnN0YXR1cyA9PT0gJ1BFTkRJTkcnKSB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1vljLnphY3miJDlip9dIOaMiSBQRU5ESU5HIOeKtuaAgeWMuemFje+8iOaWsOW8gOeahOWNoe+8iScpO1xyXG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAvLyDlpoLmnpzov5jmmK/msqHmib7liLDvvIzlj5bnrKzkuIDlvKDvvIjmnIDmlrDnmoTvvIlcclxuICAgICAgICAgIGlmICghdXBzdHJlYW1DYXJkICYmIHVwc3RyZWFtQ2FyZHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW+WQr+WPkeW8j+WMuemFjV0g5om+5LiN5YiwIFBFTkRJTkcg5Y2h77yM5L2/55So5pyA6L+R55qE5Y2hJyk7XHJcbiAgICAgICAgICAgIHVwc3RyZWFtQ2FyZCA9IHVwc3RyZWFtQ2FyZHNbMF07XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgaWYgKHVwc3RyZWFtQ2FyZCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW+WMuemFjeaIkOWKn10nLCB7XHJcbiAgICAgICAgICAgICAgY2FyZF9pZDogdXBzdHJlYW1DYXJkLmNhcmRfaWQsXHJcbiAgICAgICAgICAgICAgc3RhdHVzOiB1cHN0cmVhbUNhcmQuc3RhdHVzLFxyXG4gICAgICAgICAgICAgIG1hc2tfY2FyZF9udW1iZXI6IHVwc3RyZWFtQ2FyZC5tYXNrX2NhcmRfbnVtYmVyLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgICAgICAgIGNvbnNvbGUud2FybihgW+i9ruivouWksei0pSAke2F0dGVtcHQgKyAxfS8ke21heEF0dGVtcHRzfV1gLCBlcnI/Lm1lc3NhZ2UgfHwgZXJyKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyDlpoLmnpzmib7liLDkuobkuIrmuLjljaHkv6Hmga/vvIzmm7TmlrDmnKzlnLDorrDlvZVcclxuICAgIGlmICh1cHN0cmVhbUNhcmQgJiYgdXNlckNhcmQpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICAvLyDms6jmhI/vvJptYXNrX2NhcmRfbnVtYmVyIOaYr+aOqeeggeWNoeWPt+WmgiBcIjQ1NjU5OSoqKioqKjc2NzFcIlxyXG4gICAgICAgIC8vIOmcgOimgeebtOaOpeeUqOacgOWQjjTkvY3vvIzogIzkuI3mmK/mj5Dlj5YgY2FyZF9pZCDnmoTmnIDlkI405L2NXHJcbiAgICAgICAgbGV0IGxhc3Q0ID0gbnVsbDtcclxuICAgICAgICBcclxuICAgICAgICBpZiAodXBzdHJlYW1DYXJkLm1hc2tfY2FyZF9udW1iZXIpIHtcclxuICAgICAgICAgIC8vIOS7juaOqeeggeWNoeWPt+aPkOWPluacgOWQjjTkvY3vvJo0NTY1OTkqKioqKio3NjcxIC0+IDc2NzFcclxuICAgICAgICAgIGNvbnN0IG1hdGNoZXMgPSB1cHN0cmVhbUNhcmQubWFza19jYXJkX251bWJlci5tYXRjaCgvKFxcZHs0fSkkLyk7XHJcbiAgICAgICAgICBsYXN0NCA9IG1hdGNoZXMgPyBtYXRjaGVzWzFdIDogbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdb5ZCM5q2lXSDmj5Dlj5bljaHlj7c6JywgeyBcclxuICAgICAgICAgIG1hc2tfY2FyZF9udW1iZXI6IHVwc3RyZWFtQ2FyZC5tYXNrX2NhcmRfbnVtYmVyLFxyXG4gICAgICAgICAgbGFzdDQgXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIOiOt+WPluWNoeeahOecn+WunueKtuaAge+8iFBFTkRJTkcg55qE5Y2h6ZyA6KaB562J5b6F5r+A5rS777yJXHJcbiAgICAgICAgY29uc3QgY2FyZFN0YXR1cyA9IHVwc3RyZWFtQ2FyZC5zdGF0dXM/LnRvTG93ZXJDYXNlKCkgfHwgJ3BlbmRpbmcnO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGF3YWl0IGRiLnVzZXJDYXJkLnVwZGF0ZSh7XHJcbiAgICAgICAgICB3aGVyZTogeyBpZDogdXNlckNhcmQuaWQgfSxcclxuICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgZ3NhbGFyeUNhcmRJZDogdXBzdHJlYW1DYXJkLmNhcmRfaWQgfHwgbnVsbCxcclxuICAgICAgICAgICAgY2FyZE5vTGFzdDQ6IGxhc3Q0LCAvLyDlrZjlgqjljaHlj7flkI405L2N77yM5LiN5pivIElEIOWQjjTkvY1cclxuICAgICAgICAgICAgc3RhdHVzOiBjYXJkU3RhdHVzID09PSAncGVuZGluZycgPyAncGVuZGluZycgOiAnYWN0aXZlJyxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdb5ZCM5q2l5a6M5oiQXSDljaHniYfnirbmgIE6JywgY2FyZFN0YXR1cywgJ+WQjuWbm+S9jTonLCBsYXN0NCk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycjogYW55KSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignW+WQjOatpeWksei0pV0nLCBlcnIpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zb2xlLmxvZygnW+WQjOatpV0g5pyq5om+5Yiw5Yy56YWN55qE5Y2h54mH5oiWIHVwc3RyZWFtQ2FyZCDkuLrnqbonKTtcclxuICAgICAgY29uc29sZS5sb2coJ1vosIPor5Xkv6Hmga9dJywgeyBcclxuICAgICAgICB1cHN0cmVhbUNhcmQ6ICEhdXBzdHJlYW1DYXJkLCBcclxuICAgICAgICB1c2VyQ2FyZDogISF1c2VyQ2FyZCxcclxuICAgICAgICBhcHBseVJlc3VsdCxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgY2FyZDogdXNlckNhcmQsXHJcbiAgICAgIG1lc3NhZ2U6IGFwcGx5UmVzdWx0LnN0YXR1cyA9PT0gJ1NVQ0NFU1MnID8gJ+W8gOWNoeaIkOWKnycgOiAn5byA5Y2h55Sz6K+35bey5o+Q5Lqk77yM562J5b6F5aSE55CGJyxcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ+W8gOWNoeWksei0pTonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9LCB7IHN0YXR1czogNTAwIH0pO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiZGIiLCJ2ZXJpZnlUb2tlbiIsImdldFRva2VuRnJvbVJlcXVlc3QiLCJxdWlja0FwcGx5Q2FyZCIsImdldENhcmRzIiwiZ2V0Q2FyZERldGFpbCIsIkdFVCIsInJlcXVlc3QiLCJ0b2tlbiIsImpzb24iLCJlcnJvciIsInN0YXR1cyIsInBheWxvYWQiLCJjYXJkcyIsInVzZXJDYXJkIiwiZmluZE1hbnkiLCJ3aGVyZSIsInVzZXJJZCIsImluY2x1ZGUiLCJjYXJkVHlwZSIsIm9yZGVyQnkiLCJjcmVhdGVkQXQiLCJzeW5jQ2FyZEJhbGFuY2VzIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwibWVzc2FnZSIsImNhcmQiLCJnc2FsYXJ5Q2FyZElkIiwiZGV0YWlsIiwidXBzdHJlYW1CYWxhbmNlIiwiYXZhaWxhYmxlX2JhbGFuY2UiLCJ1cHN0cmVhbVN0YXR1cyIsIm1hc2tDYXJkTnVtYmVyIiwibWFza19jYXJkX251bWJlciIsImNhcmROb0xhc3Q0Iiwic2xpY2UiLCJuZWVkVXBkYXRlIiwiYmFsYW5jZSIsInVwZGF0ZSIsImlkIiwiZGF0YSIsImxvZyIsIm1zZyIsIlN0cmluZyIsImluY2x1ZGVzIiwiRXJyb3IiLCJQT1NUIiwiYm9keSIsImNhcmRUeXBlSWQiLCJpbml0aWFsQW1vdW50IiwidXNlciIsImZpbmRVbmlxdWUiLCJpc0FjdGl2ZSIsInJlY2hhcmdlRmVlIiwidG90YWxDb3N0Iiwib3BlbkZlZSIsInRvRml4ZWQiLCJhcHBseVJlc3VsdCIsInByb2R1Y3RfY29kZSIsImNhcmRCaW4iLCJpbml0X2JhbGFuY2UiLCJNYXRoIiwicm91bmQiLCJjYXJkU3RhdHVzIiwiZGVjcmVtZW50IiwiY3JlYXRlIiwiY2FyZF9pZCIsInRyYW5zYWN0aW9uIiwidHlwZSIsImFtb3VudCIsInVwc3RyZWFtQ2FyZCIsImhvbGRlcklkIiwicHJvY2VzcyIsImVudiIsIkdTQUxBUllfREVGQVVMVF9DQVJEX0hPTERFUl9JRCIsInVuZGVmaW5lZCIsInJlcXVlc3RfaWQiLCJtYXhBdHRlbXB0cyIsImF0dGVtcHQiLCJQcm9taXNlIiwicmVzIiwic2V0VGltZW91dCIsImNhcmRzUmVzIiwicGFnZSIsImxpbWl0IiwiY2FyZF9ob2xkZXJfaWQiLCJKU09OIiwic3RyaW5naWZ5IiwidXBzdHJlYW1DYXJkcyIsIkFycmF5IiwiaXNBcnJheSIsImxpc3QiLCJsZW5ndGgiLCJmb3JFYWNoIiwiYyIsImlkeCIsImNhcmRfbm8iLCJwYW4iLCJjcmVhdGVfdGltZSIsImZpbmQiLCJ3YXJuIiwibGFzdDQiLCJtYXRjaGVzIiwibWF0Y2giLCJ0b0xvd2VyQ2FzZSIsInN1Y2Nlc3MiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/user/cards/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   comparePassword: () => (/* binding */ comparePassword),\n/* harmony export */   generateToken: () => (/* binding */ generateToken),\n/* harmony export */   getTokenFromRequest: () => (/* binding */ getTokenFromRequest),\n/* harmony export */   hashPassword: () => (/* binding */ hashPassword),\n/* harmony export */   requireAdmin: () => (/* binding */ requireAdmin),\n/* harmony export */   verifyAuth: () => (/* binding */ verifyAuth),\n/* harmony export */   verifyToken: () => (/* binding */ verifyToken)\n/* harmony export */ });\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jsonwebtoken */ \"(rsc)/./node_modules/jsonwebtoken/index.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bcryptjs */ \"(rsc)/./node_modules/bcryptjs/index.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(bcryptjs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./src/lib/prisma.ts\");\n\n\n\n\nconst JWT_SECRET = process.env.JWT_SECRET || \"fallback-secret\";\n// 生成 token\nfunction generateToken(payload) {\n    return jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default().sign(payload, JWT_SECRET, {\n        expiresIn: \"7d\"\n    });\n}\n// 验证 token\nfunction verifyToken(token) {\n    try {\n        return jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default().verify(token, JWT_SECRET);\n    } catch  {\n        return null;\n    }\n}\n// 从请求中获取 token\nfunction getTokenFromRequest(request) {\n    const authHeader = request.headers.get(\"authorization\");\n    if (authHeader?.startsWith(\"Bearer \")) {\n        return authHeader.substring(7);\n    }\n    return null;\n}\nconst hashPassword = async (password)=>{\n    return bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().hash(password, 12);\n};\nconst comparePassword = async (password, hash)=>{\n    return bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().compare(password, hash);\n};\n// 验证 token 并返回用户\nasync function verifyAuth(request) {\n    const authHeader = request.headers.get(\"authorization\");\n    if (!authHeader?.startsWith(\"Bearer \")) {\n        return null;\n    }\n    try {\n        const token = authHeader.split(\" \")[1];\n        const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default().verify(token, JWT_SECRET);\n        return await _lib_prisma__WEBPACK_IMPORTED_MODULE_3__.prisma.user.findUnique({\n            where: {\n                id: decoded.userId\n            }\n        });\n    } catch  {\n        return null;\n    }\n}\n// 管理员权限检查\nasync function requireAdmin(request) {\n    const user = await verifyAuth(request);\n    if (!user) return next_server__WEBPACK_IMPORTED_MODULE_2__.NextResponse.json({\n        error: \"未登录\"\n    }, {\n        status: 401\n    });\n    if (user.role !== \"ADMIN\") return next_server__WEBPACK_IMPORTED_MODULE_2__.NextResponse.json({\n        error: \"无权限\"\n    }, {\n        status: 403\n    });\n    return user;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2F1dGgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUErQjtBQUNEO0FBQzBCO0FBQ2xCO0FBRXRDLE1BQU1JLGFBQWFDLFFBQVFDLEdBQUcsQ0FBQ0YsVUFBVSxJQUFJO0FBTTdDLFdBQVc7QUFDSixTQUFTRyxjQUFjQyxPQUFtQjtJQUMvQyxPQUFPUix3REFBUSxDQUFDUSxTQUFTSixZQUFZO1FBQUVNLFdBQVc7SUFBSztBQUN6RDtBQUVBLFdBQVc7QUFDSixTQUFTQyxZQUFZQyxLQUFhO0lBQ3ZDLElBQUk7UUFDRixPQUFPWiwwREFBVSxDQUFDWSxPQUFPUjtJQUMzQixFQUFFLE9BQU07UUFDTixPQUFPO0lBQ1Q7QUFDRjtBQUVBLGVBQWU7QUFDUixTQUFTVSxvQkFBb0JDLE9BQW9CO0lBQ3RELE1BQU1DLGFBQWFELFFBQVFFLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDO0lBQ3ZDLElBQUlGLFlBQVlHLFdBQVcsWUFBWTtRQUNyQyxPQUFPSCxXQUFXSSxTQUFTLENBQUM7SUFDOUI7SUFDQSxPQUFPO0FBQ1Q7QUFFTyxNQUFNQyxlQUFlLE9BQU9DO0lBQ2pDLE9BQU9yQixvREFBVyxDQUFDcUIsVUFBVTtBQUMvQixFQUFFO0FBRUssTUFBTUUsa0JBQWtCLE9BQU9GLFVBQWtCQztJQUN0RCxPQUFPdEIsdURBQWMsQ0FBQ3FCLFVBQVVDO0FBQ2xDLEVBQUU7QUFFRixpQkFBaUI7QUFDVixlQUFlRyxXQUFXWCxPQUFvQjtJQUNuRCxNQUFNQyxhQUFhRCxRQUFRRSxPQUFPLENBQUNDLEdBQUcsQ0FBQztJQUN2QyxJQUFJLENBQUNGLFlBQVlHLFdBQVcsWUFBWTtRQUN0QyxPQUFPO0lBQ1Q7SUFFQSxJQUFJO1FBQ0YsTUFBTVAsUUFBUUksV0FBV1csS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFO1FBQ3RDLE1BQU1DLFVBQVU1QiwwREFBVSxDQUFDWSxPQUFPUjtRQUNsQyxPQUFPLE1BQU1ELCtDQUFNQSxDQUFDMEIsSUFBSSxDQUFDQyxVQUFVLENBQUM7WUFBRUMsT0FBTztnQkFBRUMsSUFBSUosUUFBUUssTUFBTTtZQUFDO1FBQUU7SUFDdEUsRUFBRSxPQUFNO1FBQ04sT0FBTztJQUNUO0FBQ0Y7QUFFQSxVQUFVO0FBQ0gsZUFBZUMsYUFBYW5CLE9BQW9CO0lBQ3JELE1BQU1jLE9BQU8sTUFBTUgsV0FBV1g7SUFDOUIsSUFBSSxDQUFDYyxNQUFNLE9BQU8zQixxREFBWUEsQ0FBQ2lDLElBQUksQ0FBQztRQUFFQyxPQUFPO0lBQU0sR0FBRztRQUFFQyxRQUFRO0lBQUk7SUFDcEUsSUFBSVIsS0FBS1MsSUFBSSxLQUFLLFNBQVMsT0FBT3BDLHFEQUFZQSxDQUFDaUMsSUFBSSxDQUFDO1FBQUVDLE9BQU87SUFBTSxHQUFHO1FBQUVDLFFBQVE7SUFBSTtJQUNwRixPQUFPUjtBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2FyZHZlbGEvLi9zcmMvbGliL2F1dGgudHM/NjY5MiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgand0IGZyb20gJ2pzb253ZWJ0b2tlbic7XHJcbmltcG9ydCBiY3J5cHQgZnJvbSAnYmNyeXB0anMnO1xyXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICdAL2xpYi9wcmlzbWEnO1xyXG5cclxuY29uc3QgSldUX1NFQ1JFVCA9IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgJ2ZhbGxiYWNrLXNlY3JldCc7XHJcblxyXG5pbnRlcmZhY2UgSnd0UGF5bG9hZCB7XHJcbiAgdXNlcklkOiBzdHJpbmc7XHJcbn1cclxuXHJcbi8vIOeUn+aIkCB0b2tlblxyXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVUb2tlbihwYXlsb2FkOiBKd3RQYXlsb2FkKTogc3RyaW5nIHtcclxuICByZXR1cm4gand0LnNpZ24ocGF5bG9hZCwgSldUX1NFQ1JFVCwgeyBleHBpcmVzSW46ICc3ZCcgfSk7XHJcbn1cclxuXHJcbi8vIOmqjOivgSB0b2tlblxyXG5leHBvcnQgZnVuY3Rpb24gdmVyaWZ5VG9rZW4odG9rZW46IHN0cmluZyk6IEp3dFBheWxvYWQgfCBudWxsIHtcclxuICB0cnkge1xyXG4gICAgcmV0dXJuIGp3dC52ZXJpZnkodG9rZW4sIEpXVF9TRUNSRVQpIGFzIEp3dFBheWxvYWQ7XHJcbiAgfSBjYXRjaCB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbi8vIOS7juivt+axguS4reiOt+WPliB0b2tlblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VG9rZW5Gcm9tUmVxdWVzdChyZXF1ZXN0OiBOZXh0UmVxdWVzdCk6IHN0cmluZyB8IG51bGwge1xyXG4gIGNvbnN0IGF1dGhIZWFkZXIgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCdhdXRob3JpemF0aW9uJyk7XHJcbiAgaWYgKGF1dGhIZWFkZXI/LnN0YXJ0c1dpdGgoJ0JlYXJlciAnKSkge1xyXG4gICAgcmV0dXJuIGF1dGhIZWFkZXIuc3Vic3RyaW5nKDcpO1xyXG4gIH1cclxuICByZXR1cm4gbnVsbDtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGhhc2hQYXNzd29yZCA9IGFzeW5jIChwYXNzd29yZDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+ID0+IHtcclxuICByZXR1cm4gYmNyeXB0Lmhhc2gocGFzc3dvcmQsIDEyKTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBjb21wYXJlUGFzc3dvcmQgPSBhc3luYyAocGFzc3dvcmQ6IHN0cmluZywgaGFzaDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiA9PiB7XHJcbiAgcmV0dXJuIGJjcnlwdC5jb21wYXJlKHBhc3N3b3JkLCBoYXNoKTtcclxufTtcclxuXHJcbi8vIOmqjOivgSB0b2tlbiDlubbov5Tlm57nlKjmiLdcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZlcmlmeUF1dGgocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICBjb25zdCBhdXRoSGVhZGVyID0gcmVxdWVzdC5oZWFkZXJzLmdldCgnYXV0aG9yaXphdGlvbicpO1xyXG4gIGlmICghYXV0aEhlYWRlcj8uc3RhcnRzV2l0aCgnQmVhcmVyICcpKSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIuc3BsaXQoJyAnKVsxXTtcclxuICAgIGNvbnN0IGRlY29kZWQgPSBqd3QudmVyaWZ5KHRva2VuLCBKV1RfU0VDUkVUKSBhcyBKd3RQYXlsb2FkO1xyXG4gICAgcmV0dXJuIGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZDogZGVjb2RlZC51c2VySWQgfSB9KTtcclxuICB9IGNhdGNoIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuLy8g566h55CG5ZGY5p2D6ZmQ5qOA5p+lXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZXF1aXJlQWRtaW4ocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICBjb25zdCB1c2VyID0gYXdhaXQgdmVyaWZ5QXV0aChyZXF1ZXN0KTtcclxuICBpZiAoIXVzZXIpIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAn5pyq55m75b2VJyB9LCB7IHN0YXR1czogNDAxIH0pO1xyXG4gIGlmICh1c2VyLnJvbGUgIT09ICdBRE1JTicpIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAn5peg5p2D6ZmQJyB9LCB7IHN0YXR1czogNDAzIH0pO1xyXG4gIHJldHVybiB1c2VyO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJqd3QiLCJiY3J5cHQiLCJOZXh0UmVzcG9uc2UiLCJwcmlzbWEiLCJKV1RfU0VDUkVUIiwicHJvY2VzcyIsImVudiIsImdlbmVyYXRlVG9rZW4iLCJwYXlsb2FkIiwic2lnbiIsImV4cGlyZXNJbiIsInZlcmlmeVRva2VuIiwidG9rZW4iLCJ2ZXJpZnkiLCJnZXRUb2tlbkZyb21SZXF1ZXN0IiwicmVxdWVzdCIsImF1dGhIZWFkZXIiLCJoZWFkZXJzIiwiZ2V0Iiwic3RhcnRzV2l0aCIsInN1YnN0cmluZyIsImhhc2hQYXNzd29yZCIsInBhc3N3b3JkIiwiaGFzaCIsImNvbXBhcmVQYXNzd29yZCIsImNvbXBhcmUiLCJ2ZXJpZnlBdXRoIiwic3BsaXQiLCJkZWNvZGVkIiwidXNlciIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsImlkIiwidXNlcklkIiwicmVxdWlyZUFkbWluIiwianNvbiIsImVycm9yIiwic3RhdHVzIiwicm9sZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/db.ts":
/*!***********************!*\
  !*** ./src/lib/db.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   db: () => (/* binding */ db)\n/* harmony export */ });\n/* harmony import */ var _prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./prisma */ \"(rsc)/./src/lib/prisma.ts\");\n\nconst db = _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2RiLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQWtDO0FBRTNCLE1BQU1DLEtBQUtELDJDQUFNQSxDQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2FyZHZlbGEvLi9zcmMvbGliL2RiLnRzPzllNGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi9wcmlzbWEnO1xyXG5cclxuZXhwb3J0IGNvbnN0IGRiID0gcHJpc21hO1xyXG4iXSwibmFtZXMiOlsicHJpc21hIiwiZGIiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/db.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/gsalary.ts":
/*!****************************!*\
  !*** ./src/lib/gsalary.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   applyCard: () => (/* binding */ applyCard),\n/* harmony export */   createCardHolder: () => (/* binding */ createCardHolder),\n/* harmony export */   generateKeyPair: () => (/* binding */ generateKeyPair),\n/* harmony export */   getAvailableQuotas: () => (/* binding */ getAvailableQuotas),\n/* harmony export */   getBalance: () => (/* binding */ getBalance),\n/* harmony export */   getCardApplyResult: () => (/* binding */ getCardApplyResult),\n/* harmony export */   getCardDetail: () => (/* binding */ getCardDetail),\n/* harmony export */   getCardHolder: () => (/* binding */ getCardHolder),\n/* harmony export */   getCardHolders: () => (/* binding */ getCardHolders),\n/* harmony export */   getCardSensitiveInfo: () => (/* binding */ getCardSensitiveInfo),\n/* harmony export */   getCards: () => (/* binding */ getCards),\n/* harmony export */   modifyCardBalance: () => (/* binding */ modifyCardBalance),\n/* harmony export */   quickApplyCard: () => (/* binding */ quickApplyCard),\n/* harmony export */   rechargeCard: () => (/* binding */ rechargeCard),\n/* harmony export */   testConnection: () => (/* binding */ testConnection),\n/* harmony export */   withdrawFromCard: () => (/* binding */ withdrawFromCard)\n/* harmony export */ });\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n\nconst API_URL = process.env.GSALARY_API_URL || \"https://api.gsalary.com\";\nconst APP_ID = process.env.GSALARY_APP_ID || \"\";\nconst PRIVATE_KEY = process.env.GSALARY_PRIVATE_KEY?.replace(/\\\\n/g, \"\\n\") || \"\";\nconst USE_MOCK = process.env.GSALARY_MOCK === \"true\";\n// 默认持卡人ID（从你的商户后台获取）\nconst DEFAULT_CARD_HOLDER_ID = process.env.GSALARY_DEFAULT_CARD_HOLDER_ID || \"\";\n// 计算 Body Hash\nfunction calculateBodyHash(body) {\n    const hash = crypto__WEBPACK_IMPORTED_MODULE_0___default().createHash(\"sha256\").update(body, \"utf8\").digest();\n    return Buffer.from(hash).toString(\"base64\");\n}\n// 构建签名字符串\nfunction buildSignString(method, path, timestamp, bodyHash) {\n    return `${method} ${path}\\n${APP_ID}\\n${timestamp}\\n${bodyHash}\\n`;\n}\n// RSA SHA256 签名\nfunction signData(data) {\n    try {\n        const sign = crypto__WEBPACK_IMPORTED_MODULE_0___default().createSign(\"RSA-SHA256\");\n        sign.update(data);\n        sign.end();\n        const signature = sign.sign(PRIVATE_KEY, \"base64\");\n        return signature.replace(/\\+/g, \"-\").replace(/\\//g, \"_\");\n    } catch (error) {\n        console.error(\"签名失败:\", error);\n        throw new Error(\"签名失败，请检查私钥配置\");\n    }\n}\n// 模拟响应\nfunction mockResponse(endpoint, data) {\n    const cardNo = `4111${Math.floor(1000000000000 + Math.random() * 9000000000000)}`;\n    if (endpoint.includes(\"card_applies\")) {\n        return {\n            request_id: data?.request_id || `REQ_${Date.now()}`,\n            status: \"PROCESSING\",\n            card_id: `MOCK_CARD_${Date.now()}`\n        };\n    }\n    if (endpoint.includes(\"card_holders\") && data) {\n        return {\n            card_holder_id: `MOCK_HOLDER_${Date.now()}`,\n            status: \"ACTIVE\"\n        };\n    }\n    if (endpoint.includes(\"cards\") && endpoint.includes(\"sensitive\")) {\n        return {\n            card_no: cardNo,\n            cvv: \"123\",\n            expiry_date: \"12/28\"\n        };\n    }\n    if (endpoint.includes(\"cards\")) {\n        return {\n            cards: [],\n            page: 1,\n            limit: 20,\n            total_count: 0\n        };\n    }\n    if (endpoint.includes(\"balance\")) {\n        return {\n            balance: 10000\n        };\n    }\n    return {};\n}\n// 通用请求方法\nasync function request(endpoint, method = \"POST\", data) {\n    if (USE_MOCK) {\n        console.log(`[GSalary Mock] ${method} ${endpoint}`, data);\n        return mockResponse(endpoint, data);\n    }\n    const timestamp = Date.now().toString();\n    const body = data ? JSON.stringify(data) : \"\";\n    const bodyHash = body ? calculateBodyHash(body) : \"\";\n    const signString = buildSignString(method.toUpperCase(), endpoint, timestamp, bodyHash);\n    console.log(\"[GSalary] Sign String:\", signString);\n    const signature = signData(signString);\n    const url = `${API_URL}${endpoint}`;\n    console.log(`[GSalary] ${method} ${url}`);\n    const headers = {\n        \"Content-Type\": \"application/json\",\n        \"X-Appid\": APP_ID,\n        \"Authorization\": `algorithm=RSA2,time=${timestamp},signature=${signature}`\n    };\n    const options = {\n        method,\n        headers\n    };\n    if (body) options.body = body;\n    console.log(\"[GSalary] Headers:\", headers);\n    console.log(\"[GSalary] Body:\", body);\n    const response = await fetch(url, options);\n    const result = await response.json();\n    console.log(\"[GSalary] Response:\", JSON.stringify(result, null, 2));\n    if (!response.ok) {\n        throw new Error(`GSalary HTTP ${response.status}: ${result?.message || result?.error || JSON.stringify(result)}`);\n    }\n    if (result?.result?.result === \"F\" || result?.error || result?.error_code) {\n        throw new Error(`GSalary API 错误: ${result?.result?.message || result?.message || JSON.stringify(result)}`);\n    }\n    return result.data || result;\n}\n// ==================== 持卡人接口 ====================\n// 查询持卡人列表 - GET /v1/card_holders\nasync function getCardHolders(params) {\n    const query = new URLSearchParams();\n    if (params?.page) query.set(\"page\", params.page.toString());\n    if (params?.limit) query.set(\"limit\", params.limit.toString());\n    if (params?.email) query.set(\"email\", params.email);\n    if (params?.mobile) query.set(\"mobile\", params.mobile);\n    const queryStr = query.toString();\n    return request(`/v1/card_holders${queryStr ? \"?\" + queryStr : \"\"}`, \"GET\");\n}\n// 创建持卡人 - POST /v1/card_holders\nasync function createCardHolder(data) {\n    return request(\"/v1/card_holders\", \"POST\", data);\n}\n// 查看持卡人信息 - GET /v1/card_holders/{card_holder_id}\nasync function getCardHolder(cardHolderId) {\n    return request(`/v1/card_holders/${cardHolderId}`, \"GET\");\n}\n// ==================== 开卡接口 ====================\n// 申请开卡 - POST /v1/card_applies\nasync function applyCard(data) {\n    return request(\"/v1/card_applies\", \"POST\", data);\n}\n// 查询开卡结果 - GET /v1/card_applies/{request_id}\nasync function getCardApplyResult(requestId) {\n    return request(`/v1/card_applies/${requestId}`, \"GET\");\n}\n// 便捷开卡方法（使用默认持卡人）\nasync function quickApplyCard(data) {\n    const requestId = `REQ_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n    const holderId = data.card_holder_id || DEFAULT_CARD_HOLDER_ID;\n    if (!holderId) {\n        throw new Error(\"未配置默认持卡人ID\");\n    }\n    return applyCard({\n        request_id: requestId,\n        product_code: data.product_code,\n        currency: \"USD\",\n        card_holder_id: holderId,\n        init_balance: data.init_balance\n    });\n}\n// ==================== 卡片管理接口 ====================\n// 查询卡列表 - GET /v1/cards\nasync function getCards(params) {\n    const query = new URLSearchParams();\n    if (params?.page) query.set(\"page\", params.page.toString());\n    if (params?.limit) query.set(\"limit\", params.limit.toString());\n    if (params?.product_code) query.set(\"product_code\", params.product_code);\n    if (params?.card_holder_id) query.set(\"card_holder_id\", params.card_holder_id);\n    if (params?.status) query.set(\"status\", params.status);\n    const queryStr = query.toString();\n    return request(`/v1/cards${queryStr ? \"?\" + queryStr : \"\"}`, \"GET\");\n}\n// 查看卡信息 - GET /v1/cards/{card_id}\nasync function getCardDetail(cardId) {\n    return request(`/v1/cards/${cardId}`, \"GET\");\n}\n// 获取卡敏感信息 - GET /v1/cards/{card_id}/secure_info（注意路径需要 /v1）\nasync function getCardSensitiveInfo(cardId) {\n    return request(`/v1/cards/${cardId}/secure_info`, \"GET\");\n}\n// 查询卡可用配额 - GET /v1/cards/available_quotas\nasync function getAvailableQuotas(currency = \"USD\", accountingCardType) {\n    const params = new URLSearchParams();\n    params.set(\"currency\", currency);\n    if (accountingCardType) {\n        params.set(\"accounting_card_type\", accountingCardType);\n    }\n    return request(`/v1/cards/available_quotas?${params.toString()}`, \"GET\");\n}\n// 卡片调额 - POST /v1/cards/balance_modifies\nasync function modifyCardBalance(data) {\n    console.log(\"[GSalary] 卡片调额请求:\", JSON.stringify(data));\n    return request(\"/v1/cards/balance_modifies\", \"POST\", data);\n}\n// 卡充值（金额单位：元）\nasync function rechargeCard(cardId, amount) {\n    const requestId = `RCH${Date.now()}`;\n    return modifyCardBalance({\n        card_id: cardId,\n        amount: amount,\n        type: \"INCREASE\",\n        request_id: requestId\n    });\n}\n// 卡提现（金额单位：元，正数，type 为 DECREASE 表示减少）\nasync function withdrawFromCard(cardId, amount) {\n    const requestId = `WDR${Date.now()}`;\n    console.log(\"[GSalary] 卡提现:\", {\n        cardId,\n        amount\n    });\n    return modifyCardBalance({\n        card_id: cardId,\n        amount: amount,\n        type: \"DECREASE\",\n        request_id: requestId\n    });\n}\n// 查询商户余额 - GET /v1/merchant/balance\nasync function getBalance() {\n    return request(\"/v1/merchant/balance\", \"GET\");\n}\n// 测试连通性\nasync function testConnection() {\n    try {\n        const result = await getCardHolders({\n            page: 1,\n            limit: 1\n        });\n        console.log(\"[GSalary] 连通性测试成功:\", result);\n        return {\n            success: true,\n            result\n        };\n    } catch (err) {\n        console.error(\"[GSalary] 连通性测试失败:\", err.message);\n        return {\n            success: false,\n            error: err.message\n        };\n    }\n}\nfunction generateKeyPair() {\n    const { publicKey, privateKey } = crypto__WEBPACK_IMPORTED_MODULE_0___default().generateKeyPairSync(\"rsa\", {\n        modulusLength: 4096,\n        publicKeyEncoding: {\n            type: \"spki\",\n            format: \"pem\"\n        },\n        privateKeyEncoding: {\n            type: \"pkcs8\",\n            format: \"pem\"\n        }\n    });\n    return {\n        publicKey,\n        privateKey\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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L0IsZUFBZWlCLGlCQUFpQlIsTUFBYyxFQUFFTSxNQUFjO0lBQ25FLE1BQU1mLFlBQVksQ0FBQyxHQUFHLEVBQUUxQyxLQUFLQyxHQUFHLEdBQUcsQ0FBQztJQUNwQ1gsUUFBUXdCLEdBQUcsQ0FBQyxrQkFBa0I7UUFBRXFDO1FBQVFNO0lBQU87SUFDL0MsT0FBT0Ysa0JBQWtCO1FBQ3ZCcEQsU0FBU2dEO1FBQ1RNLFFBQVFBO1FBQ1JDLE1BQU07UUFDTjNELFlBQVkyQztJQUNkO0FBQ0Y7QUFFQSxvQ0FBb0M7QUFDN0IsZUFBZWtCO0lBQ3BCLE9BQU8vQyxRQUFRLHdCQUF3QjtBQUN6QztBQUVBLFFBQVE7QUFDRCxlQUFlZ0Q7SUFDcEIsSUFBSTtRQUNGLE1BQU1yQyxTQUFTLE1BQU1LLGVBQWU7WUFBRXBCLE1BQU07WUFBR0MsT0FBTztRQUFFO1FBQ3hEcEIsUUFBUXdCLEdBQUcsQ0FBQyxzQkFBc0JVO1FBQ2xDLE9BQU87WUFBRXNDLFNBQVM7WUFBTXRDO1FBQU87SUFDakMsRUFBRSxPQUFPdUMsS0FBVTtRQUNqQnpFLFFBQVFELEtBQUssQ0FBQyxzQkFBc0IwRSxJQUFJcEMsT0FBTztRQUMvQyxPQUFPO1lBQUVtQyxTQUFTO1lBQU96RSxPQUFPMEUsSUFBSXBDLE9BQU87UUFBQztJQUM5QztBQUNGO0FBRU8sU0FBU3FDO0lBQ2QsTUFBTSxFQUFFQyxTQUFTLEVBQUVDLFVBQVUsRUFBRSxHQUFHL0csaUVBQTBCLENBQUMsT0FBTztRQUNsRWlILGVBQWU7UUFDZkMsbUJBQW1CO1lBQUVYLE1BQU07WUFBUVksUUFBUTtRQUFNO1FBQ2pEQyxvQkFBb0I7WUFBRWIsTUFBTTtZQUFTWSxRQUFRO1FBQU07SUFDckQ7SUFDQSxPQUFPO1FBQUVMO1FBQVdDO0lBQVc7QUFDakMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jYXJkdmVsYS8uL3NyYy9saWIvZ3NhbGFyeS50cz9mZTFlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjcnlwdG8gZnJvbSAnY3J5cHRvJztcclxuXHJcbmNvbnN0IEFQSV9VUkwgPSBwcm9jZXNzLmVudi5HU0FMQVJZX0FQSV9VUkwgfHwgJ2h0dHBzOi8vYXBpLmdzYWxhcnkuY29tJztcclxuY29uc3QgQVBQX0lEID0gcHJvY2Vzcy5lbnYuR1NBTEFSWV9BUFBfSUQgfHwgJyc7XHJcbmNvbnN0IFBSSVZBVEVfS0VZID0gcHJvY2Vzcy5lbnYuR1NBTEFSWV9QUklWQVRFX0tFWT8ucmVwbGFjZSgvXFxcXG4vZywgJ1xcbicpIHx8ICcnO1xyXG5jb25zdCBVU0VfTU9DSyA9IHByb2Nlc3MuZW52LkdTQUxBUllfTU9DSyA9PT0gJ3RydWUnO1xyXG4vLyDpu5jorqTmjIHljaHkurpJRO+8iOS7juS9oOeahOWVhuaIt+WQjuWPsOiOt+WPlu+8iVxyXG5jb25zdCBERUZBVUxUX0NBUkRfSE9MREVSX0lEID0gcHJvY2Vzcy5lbnYuR1NBTEFSWV9ERUZBVUxUX0NBUkRfSE9MREVSX0lEIHx8ICcnO1xyXG5cclxuLy8g6K6h566XIEJvZHkgSGFzaFxyXG5mdW5jdGlvbiBjYWxjdWxhdGVCb2R5SGFzaChib2R5OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gIGNvbnN0IGhhc2ggPSBjcnlwdG8uY3JlYXRlSGFzaCgnc2hhMjU2JykudXBkYXRlKGJvZHksICd1dGY4JykuZGlnZXN0KCk7XHJcbiAgcmV0dXJuIEJ1ZmZlci5mcm9tKGhhc2gpLnRvU3RyaW5nKCdiYXNlNjQnKTtcclxufVxyXG5cclxuLy8g5p6E5bu6562+5ZCN5a2X56ym5LiyXHJcbmZ1bmN0aW9uIGJ1aWxkU2lnblN0cmluZyhtZXRob2Q6IHN0cmluZywgcGF0aDogc3RyaW5nLCB0aW1lc3RhbXA6IHN0cmluZywgYm9keUhhc2g6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgcmV0dXJuIGAke21ldGhvZH0gJHtwYXRofVxcbiR7QVBQX0lEfVxcbiR7dGltZXN0YW1wfVxcbiR7Ym9keUhhc2h9XFxuYDtcclxufVxyXG5cclxuLy8gUlNBIFNIQTI1NiDnrb7lkI1cclxuZnVuY3Rpb24gc2lnbkRhdGEoZGF0YTogc3RyaW5nKTogc3RyaW5nIHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc2lnbiA9IGNyeXB0by5jcmVhdGVTaWduKCdSU0EtU0hBMjU2Jyk7XHJcbiAgICBzaWduLnVwZGF0ZShkYXRhKTtcclxuICAgIHNpZ24uZW5kKCk7XHJcbiAgICBjb25zdCBzaWduYXR1cmUgPSBzaWduLnNpZ24oUFJJVkFURV9LRVksICdiYXNlNjQnKTtcclxuICAgIHJldHVybiBzaWduYXR1cmUucmVwbGFjZSgvXFwrL2csICctJykucmVwbGFjZSgvXFwvL2csICdfJyk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ+etvuWQjeWksei0pTonLCBlcnJvcik7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ+etvuWQjeWksei0pe+8jOivt+ajgOafpeengemSpemFjee9ricpO1xyXG4gIH1cclxufVxyXG5cclxuLy8g5qih5ouf5ZON5bqUXHJcbmZ1bmN0aW9uIG1vY2tSZXNwb25zZShlbmRwb2ludDogc3RyaW5nLCBkYXRhOiBhbnkpIHtcclxuICBjb25zdCBjYXJkTm8gPSBgNDExMSR7TWF0aC5mbG9vcigxMDAwMDAwMDAwMDAwICsgTWF0aC5yYW5kb20oKSAqIDkwMDAwMDAwMDAwMDApfWA7XHJcbiAgXHJcbiAgaWYgKGVuZHBvaW50LmluY2x1ZGVzKCdjYXJkX2FwcGxpZXMnKSkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcmVxdWVzdF9pZDogZGF0YT8ucmVxdWVzdF9pZCB8fCBgUkVRXyR7RGF0ZS5ub3coKX1gLFxyXG4gICAgICBzdGF0dXM6ICdQUk9DRVNTSU5HJyxcclxuICAgICAgY2FyZF9pZDogYE1PQ0tfQ0FSRF8ke0RhdGUubm93KCl9YCxcclxuICAgIH07XHJcbiAgfVxyXG4gIGlmIChlbmRwb2ludC5pbmNsdWRlcygnY2FyZF9ob2xkZXJzJykgJiYgZGF0YSkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgY2FyZF9ob2xkZXJfaWQ6IGBNT0NLX0hPTERFUl8ke0RhdGUubm93KCl9YCxcclxuICAgICAgc3RhdHVzOiAnQUNUSVZFJyxcclxuICAgIH07XHJcbiAgfVxyXG4gIGlmIChlbmRwb2ludC5pbmNsdWRlcygnY2FyZHMnKSAmJiBlbmRwb2ludC5pbmNsdWRlcygnc2Vuc2l0aXZlJykpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGNhcmRfbm86IGNhcmRObyxcclxuICAgICAgY3Z2OiAnMTIzJyxcclxuICAgICAgZXhwaXJ5X2RhdGU6ICcxMi8yOCcsXHJcbiAgICB9O1xyXG4gIH1cclxuICBpZiAoZW5kcG9pbnQuaW5jbHVkZXMoJ2NhcmRzJykpIHtcclxuICAgIHJldHVybiB7IGNhcmRzOiBbXSwgcGFnZTogMSwgbGltaXQ6IDIwLCB0b3RhbF9jb3VudDogMCB9O1xyXG4gIH1cclxuICBpZiAoZW5kcG9pbnQuaW5jbHVkZXMoJ2JhbGFuY2UnKSkge1xyXG4gICAgcmV0dXJuIHsgYmFsYW5jZTogMTAwMDAgfTtcclxuICB9XHJcbiAgcmV0dXJuIHt9O1xyXG59XHJcblxyXG4vLyDpgJrnlKjor7fmsYLmlrnms5VcclxuYXN5bmMgZnVuY3Rpb24gcmVxdWVzdChlbmRwb2ludDogc3RyaW5nLCBtZXRob2Q6IHN0cmluZyA9ICdQT1NUJywgZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT4pIHtcclxuICBpZiAoVVNFX01PQ0spIHtcclxuICAgIGNvbnNvbGUubG9nKGBbR1NhbGFyeSBNb2NrXSAke21ldGhvZH0gJHtlbmRwb2ludH1gLCBkYXRhKTtcclxuICAgIHJldHVybiBtb2NrUmVzcG9uc2UoZW5kcG9pbnQsIGRhdGEpO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKS50b1N0cmluZygpO1xyXG4gIGNvbnN0IGJvZHkgPSBkYXRhID8gSlNPTi5zdHJpbmdpZnkoZGF0YSkgOiAnJztcclxuICBjb25zdCBib2R5SGFzaCA9IGJvZHkgPyBjYWxjdWxhdGVCb2R5SGFzaChib2R5KSA6ICcnO1xyXG4gIFxyXG4gIGNvbnN0IHNpZ25TdHJpbmcgPSBidWlsZFNpZ25TdHJpbmcobWV0aG9kLnRvVXBwZXJDYXNlKCksIGVuZHBvaW50LCB0aW1lc3RhbXAsIGJvZHlIYXNoKTtcclxuICBjb25zb2xlLmxvZygnW0dTYWxhcnldIFNpZ24gU3RyaW5nOicsIHNpZ25TdHJpbmcpO1xyXG4gIFxyXG4gIGNvbnN0IHNpZ25hdHVyZSA9IHNpZ25EYXRhKHNpZ25TdHJpbmcpO1xyXG5cclxuICBjb25zdCB1cmwgPSBgJHtBUElfVVJMfSR7ZW5kcG9pbnR9YDtcclxuICBjb25zb2xlLmxvZyhgW0dTYWxhcnldICR7bWV0aG9kfSAke3VybH1gKTtcclxuXHJcbiAgY29uc3QgaGVhZGVyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcclxuICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAnWC1BcHBpZCc6IEFQUF9JRCxcclxuICAgICdBdXRob3JpemF0aW9uJzogYGFsZ29yaXRobT1SU0EyLHRpbWU9JHt0aW1lc3RhbXB9LHNpZ25hdHVyZT0ke3NpZ25hdHVyZX1gLFxyXG4gIH07XHJcblxyXG4gIGNvbnN0IG9wdGlvbnM6IFJlcXVlc3RJbml0ID0geyBtZXRob2QsIGhlYWRlcnMgfTtcclxuICBpZiAoYm9keSkgb3B0aW9ucy5ib2R5ID0gYm9keTtcclxuXHJcbiAgY29uc29sZS5sb2coJ1tHU2FsYXJ5XSBIZWFkZXJzOicsIGhlYWRlcnMpO1xyXG4gIGNvbnNvbGUubG9nKCdbR1NhbGFyeV0gQm9keTonLCBib2R5KTtcclxuXHJcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIG9wdGlvbnMpO1xyXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuICBjb25zb2xlLmxvZygnW0dTYWxhcnldIFJlc3BvbnNlOicsIEpTT04uc3RyaW5naWZ5KHJlc3VsdCwgbnVsbCwgMikpO1xyXG5cclxuICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEdTYWxhcnkgSFRUUCAke3Jlc3BvbnNlLnN0YXR1c306ICR7cmVzdWx0Py5tZXNzYWdlIHx8IHJlc3VsdD8uZXJyb3IgfHwgSlNPTi5zdHJpbmdpZnkocmVzdWx0KX1gKTtcclxuICB9XHJcblxyXG4gIGlmIChyZXN1bHQ/LnJlc3VsdD8ucmVzdWx0ID09PSAnRicgfHwgcmVzdWx0Py5lcnJvciB8fCByZXN1bHQ/LmVycm9yX2NvZGUpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihgR1NhbGFyeSBBUEkg6ZSZ6K+vOiAke3Jlc3VsdD8ucmVzdWx0Py5tZXNzYWdlIHx8IHJlc3VsdD8ubWVzc2FnZSB8fCBKU09OLnN0cmluZ2lmeShyZXN1bHQpfWApO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHJlc3VsdC5kYXRhIHx8IHJlc3VsdDtcclxufVxyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT0g5oyB5Y2h5Lq65o6l5Y+jID09PT09PT09PT09PT09PT09PT09XHJcblxyXG4vLyDmn6Xor6LmjIHljaHkurrliJfooaggLSBHRVQgL3YxL2NhcmRfaG9sZGVyc1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q2FyZEhvbGRlcnMocGFyYW1zPzoge1xyXG4gIHBhZ2U/OiBudW1iZXI7XHJcbiAgbGltaXQ/OiBudW1iZXI7XHJcbiAgZW1haWw/OiBzdHJpbmc7XHJcbiAgbW9iaWxlPzogc3RyaW5nO1xyXG59KSB7XHJcbiAgY29uc3QgcXVlcnkgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XHJcbiAgaWYgKHBhcmFtcz8ucGFnZSkgcXVlcnkuc2V0KCdwYWdlJywgcGFyYW1zLnBhZ2UudG9TdHJpbmcoKSk7XHJcbiAgaWYgKHBhcmFtcz8ubGltaXQpIHF1ZXJ5LnNldCgnbGltaXQnLCBwYXJhbXMubGltaXQudG9TdHJpbmcoKSk7XHJcbiAgaWYgKHBhcmFtcz8uZW1haWwpIHF1ZXJ5LnNldCgnZW1haWwnLCBwYXJhbXMuZW1haWwpO1xyXG4gIGlmIChwYXJhbXM/Lm1vYmlsZSkgcXVlcnkuc2V0KCdtb2JpbGUnLCBwYXJhbXMubW9iaWxlKTtcclxuICBjb25zdCBxdWVyeVN0ciA9IHF1ZXJ5LnRvU3RyaW5nKCk7XHJcbiAgcmV0dXJuIHJlcXVlc3QoYC92MS9jYXJkX2hvbGRlcnMke3F1ZXJ5U3RyID8gJz8nICsgcXVlcnlTdHIgOiAnJ31gLCAnR0VUJyk7XHJcbn1cclxuXHJcbi8vIOWIm+W7uuaMgeWNoeS6uiAtIFBPU1QgL3YxL2NhcmRfaG9sZGVyc1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlQ2FyZEhvbGRlcihkYXRhOiB7XHJcbiAgZmlyc3RfbmFtZTogc3RyaW5nO1xyXG4gIGxhc3RfbmFtZTogc3RyaW5nO1xyXG4gIGJpcnRoOiBzdHJpbmc7XHJcbiAgZW1haWw6IHN0cmluZztcclxuICBtb2JpbGU6IHsgbmF0aW9uX2NvZGU6IHN0cmluZzsgbW9iaWxlOiBzdHJpbmcgfTtcclxuICByZWdpb246IHN0cmluZztcclxuICBiaWxsX2FkZHJlc3M/OiB7XHJcbiAgICBwb3N0Y29kZTogc3RyaW5nO1xyXG4gICAgYWRkcmVzczogc3RyaW5nO1xyXG4gICAgY2l0eTogc3RyaW5nO1xyXG4gICAgc3RhdGU6IHN0cmluZztcclxuICAgIGNvdW50cnk6IHN0cmluZztcclxuICB9O1xyXG59KSB7XHJcbiAgcmV0dXJuIHJlcXVlc3QoJy92MS9jYXJkX2hvbGRlcnMnLCAnUE9TVCcsIGRhdGEpO1xyXG59XHJcblxyXG4vLyDmn6XnnIvmjIHljaHkurrkv6Hmga8gLSBHRVQgL3YxL2NhcmRfaG9sZGVycy97Y2FyZF9ob2xkZXJfaWR9XHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDYXJkSG9sZGVyKGNhcmRIb2xkZXJJZDogc3RyaW5nKSB7XHJcbiAgcmV0dXJuIHJlcXVlc3QoYC92MS9jYXJkX2hvbGRlcnMvJHtjYXJkSG9sZGVySWR9YCwgJ0dFVCcpO1xyXG59XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PSDlvIDljaHmjqXlj6MgPT09PT09PT09PT09PT09PT09PT1cclxuXHJcbi8vIOeUs+ivt+W8gOWNoSAtIFBPU1QgL3YxL2NhcmRfYXBwbGllc1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXBwbHlDYXJkKGRhdGE6IHtcclxuICByZXF1ZXN0X2lkOiBzdHJpbmc7XHJcbiAgcHJvZHVjdF9jb2RlOiBzdHJpbmc7XHJcbiAgY3VycmVuY3k6IHN0cmluZztcclxuICBjYXJkX2hvbGRlcl9pZDogc3RyaW5nO1xyXG4gIGluaXRfYmFsYW5jZTogbnVtYmVyO1xyXG4gIGxpbWl0X3Blcl9kYXk/OiBudW1iZXI7XHJcbiAgbGltaXRfcGVyX21vbnRoPzogbnVtYmVyO1xyXG4gIGxpbWl0X3Blcl90cmFuc2FjdGlvbj86IG51bWJlcjtcclxufSkge1xyXG4gIHJldHVybiByZXF1ZXN0KCcvdjEvY2FyZF9hcHBsaWVzJywgJ1BPU1QnLCBkYXRhKTtcclxufVxyXG5cclxuLy8g5p+l6K+i5byA5Y2h57uT5p6cIC0gR0VUIC92MS9jYXJkX2FwcGxpZXMve3JlcXVlc3RfaWR9XHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDYXJkQXBwbHlSZXN1bHQocmVxdWVzdElkOiBzdHJpbmcpIHtcclxuICByZXR1cm4gcmVxdWVzdChgL3YxL2NhcmRfYXBwbGllcy8ke3JlcXVlc3RJZH1gLCAnR0VUJyk7XHJcbn1cclxuXHJcbi8vIOS+v+aNt+W8gOWNoeaWueazle+8iOS9v+eUqOm7mOiupOaMgeWNoeS6uu+8iVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcXVpY2tBcHBseUNhcmQoZGF0YToge1xyXG4gIHByb2R1Y3RfY29kZTogc3RyaW5nO1xyXG4gIGluaXRfYmFsYW5jZTogbnVtYmVyO1xyXG4gIGNhcmRfaG9sZGVyX2lkPzogc3RyaW5nO1xyXG59KSB7XHJcbiAgY29uc3QgcmVxdWVzdElkID0gYFJFUV8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgOCl9YDtcclxuICBjb25zdCBob2xkZXJJZCA9IGRhdGEuY2FyZF9ob2xkZXJfaWQgfHwgREVGQVVMVF9DQVJEX0hPTERFUl9JRDtcclxuICBcclxuICBpZiAoIWhvbGRlcklkKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ+acqumFjee9rum7mOiupOaMgeWNoeS6uklEJyk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gYXBwbHlDYXJkKHtcclxuICAgIHJlcXVlc3RfaWQ6IHJlcXVlc3RJZCxcclxuICAgIHByb2R1Y3RfY29kZTogZGF0YS5wcm9kdWN0X2NvZGUsXHJcbiAgICBjdXJyZW5jeTogJ1VTRCcsXHJcbiAgICBjYXJkX2hvbGRlcl9pZDogaG9sZGVySWQsXHJcbiAgICBpbml0X2JhbGFuY2U6IGRhdGEuaW5pdF9iYWxhbmNlLFxyXG4gICAgLy8g56e76Zmk5oiW6ZmN5L2O6ZmQ6aKd5Y+C5pWw77yM6K6p5LiK5ri45L2/55So6buY6K6k5YC8XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09IOWNoeeJh+euoeeQhuaOpeWPoyA9PT09PT09PT09PT09PT09PT09PVxyXG5cclxuLy8g5p+l6K+i5Y2h5YiX6KGoIC0gR0VUIC92MS9jYXJkc1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q2FyZHMocGFyYW1zPzogeyBcclxuICBwYWdlPzogbnVtYmVyOyBcclxuICBsaW1pdD86IG51bWJlcjtcclxuICBwcm9kdWN0X2NvZGU/OiBzdHJpbmc7XHJcbiAgY2FyZF9ob2xkZXJfaWQ/OiBzdHJpbmc7XHJcbiAgc3RhdHVzPzogc3RyaW5nO1xyXG59KSB7XHJcbiAgY29uc3QgcXVlcnkgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XHJcbiAgaWYgKHBhcmFtcz8ucGFnZSkgcXVlcnkuc2V0KCdwYWdlJywgcGFyYW1zLnBhZ2UudG9TdHJpbmcoKSk7XHJcbiAgaWYgKHBhcmFtcz8ubGltaXQpIHF1ZXJ5LnNldCgnbGltaXQnLCBwYXJhbXMubGltaXQudG9TdHJpbmcoKSk7XHJcbiAgaWYgKHBhcmFtcz8ucHJvZHVjdF9jb2RlKSBxdWVyeS5zZXQoJ3Byb2R1Y3RfY29kZScsIHBhcmFtcy5wcm9kdWN0X2NvZGUpO1xyXG4gIGlmIChwYXJhbXM/LmNhcmRfaG9sZGVyX2lkKSBxdWVyeS5zZXQoJ2NhcmRfaG9sZGVyX2lkJywgcGFyYW1zLmNhcmRfaG9sZGVyX2lkKTtcclxuICBpZiAocGFyYW1zPy5zdGF0dXMpIHF1ZXJ5LnNldCgnc3RhdHVzJywgcGFyYW1zLnN0YXR1cyk7XHJcbiAgY29uc3QgcXVlcnlTdHIgPSBxdWVyeS50b1N0cmluZygpO1xyXG4gIHJldHVybiByZXF1ZXN0KGAvdjEvY2FyZHMke3F1ZXJ5U3RyID8gJz8nICsgcXVlcnlTdHIgOiAnJ31gLCAnR0VUJyk7XHJcbn1cclxuXHJcbi8vIOafpeeci+WNoeS/oeaBryAtIEdFVCAvdjEvY2FyZHMve2NhcmRfaWR9XHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDYXJkRGV0YWlsKGNhcmRJZDogc3RyaW5nKSB7XHJcbiAgcmV0dXJuIHJlcXVlc3QoYC92MS9jYXJkcy8ke2NhcmRJZH1gLCAnR0VUJyk7XHJcbn1cclxuXHJcbi8vIOiOt+WPluWNoeaVj+aEn+S/oeaBryAtIEdFVCAvdjEvY2FyZHMve2NhcmRfaWR9L3NlY3VyZV9pbmZv77yI5rOo5oSP6Lev5b6E6ZyA6KaBIC92Me+8iVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q2FyZFNlbnNpdGl2ZUluZm8oY2FyZElkOiBzdHJpbmcpIHtcclxuICByZXR1cm4gcmVxdWVzdChgL3YxL2NhcmRzLyR7Y2FyZElkfS9zZWN1cmVfaW5mb2AsICdHRVQnKTtcclxufVxyXG5cclxuLy8g5p+l6K+i5Y2h5Y+v55So6YWN6aKdIC0gR0VUIC92MS9jYXJkcy9hdmFpbGFibGVfcXVvdGFzXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBdmFpbGFibGVRdW90YXMoY3VycmVuY3k6IHN0cmluZyA9ICdVU0QnLCBhY2NvdW50aW5nQ2FyZFR5cGU/OiAnU0hBUkUnIHwgJ1JFQ0hBUkdFJykge1xyXG4gIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcclxuICBwYXJhbXMuc2V0KCdjdXJyZW5jeScsIGN1cnJlbmN5KTtcclxuICBpZiAoYWNjb3VudGluZ0NhcmRUeXBlKSB7XHJcbiAgICBwYXJhbXMuc2V0KCdhY2NvdW50aW5nX2NhcmRfdHlwZScsIGFjY291bnRpbmdDYXJkVHlwZSk7XHJcbiAgfVxyXG4gIHJldHVybiByZXF1ZXN0KGAvdjEvY2FyZHMvYXZhaWxhYmxlX3F1b3Rhcz8ke3BhcmFtcy50b1N0cmluZygpfWAsICdHRVQnKTtcclxufVxyXG5cclxuLy8g5Y2h54mH6LCD6aKdIC0gUE9TVCAvdjEvY2FyZHMvYmFsYW5jZV9tb2RpZmllc1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbW9kaWZ5Q2FyZEJhbGFuY2UoZGF0YToge1xyXG4gIGNhcmRfaWQ6IHN0cmluZztcclxuICBhbW91bnQ6IG51bWJlcjsgIC8vIOWNleS9je+8muWFg++8iFVTRO+8ie+8jOS4jeaYr+WIhu+8gVxyXG4gIHR5cGU6ICdJTkNSRUFTRScgfCAnREVDUkVBU0UnO1xyXG4gIHJlcXVlc3RfaWQ6IHN0cmluZztcclxufSkge1xyXG4gIGNvbnNvbGUubG9nKCdbR1NhbGFyeV0g5Y2h54mH6LCD6aKd6K+35rGCOicsIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcclxuICByZXR1cm4gcmVxdWVzdCgnL3YxL2NhcmRzL2JhbGFuY2VfbW9kaWZpZXMnLCAnUE9TVCcsIGRhdGEpO1xyXG59XHJcblxyXG4vLyDljaHlhYXlgLzvvIjph5Hpop3ljZXkvY3vvJrlhYPvvIlcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlY2hhcmdlQ2FyZChjYXJkSWQ6IHN0cmluZywgYW1vdW50OiBudW1iZXIpIHtcclxuICBjb25zdCByZXF1ZXN0SWQgPSBgUkNIJHtEYXRlLm5vdygpfWA7XHJcbiAgcmV0dXJuIG1vZGlmeUNhcmRCYWxhbmNlKHtcclxuICAgIGNhcmRfaWQ6IGNhcmRJZCxcclxuICAgIGFtb3VudDogYW1vdW50LCAgLy8g55u05o6l55So5YWD77yM5LiN6L2s5o2iXHJcbiAgICB0eXBlOiAnSU5DUkVBU0UnLFxyXG4gICAgcmVxdWVzdF9pZDogcmVxdWVzdElkLFxyXG4gIH0pO1xyXG59XHJcblxyXG4vLyDljaHmj5DnjrDvvIjph5Hpop3ljZXkvY3vvJrlhYPvvIzmraPmlbDvvIx0eXBlIOS4uiBERUNSRUFTRSDooajnpLrlh4/lsJHvvIlcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHdpdGhkcmF3RnJvbUNhcmQoY2FyZElkOiBzdHJpbmcsIGFtb3VudDogbnVtYmVyKSB7XHJcbiAgY29uc3QgcmVxdWVzdElkID0gYFdEUiR7RGF0ZS5ub3coKX1gO1xyXG4gIGNvbnNvbGUubG9nKCdbR1NhbGFyeV0g5Y2h5o+Q546wOicsIHsgY2FyZElkLCBhbW91bnQgfSk7XHJcbiAgcmV0dXJuIG1vZGlmeUNhcmRCYWxhbmNlKHtcclxuICAgIGNhcmRfaWQ6IGNhcmRJZCxcclxuICAgIGFtb3VudDogYW1vdW50LCAgLy8g5q2j5pWw77yMQVBJIOS8muagueaNriB0eXBlIOWIpOaWreWinuWHj1xyXG4gICAgdHlwZTogJ0RFQ1JFQVNFJyxcclxuICAgIHJlcXVlc3RfaWQ6IHJlcXVlc3RJZCxcclxuICB9KTtcclxufVxyXG5cclxuLy8g5p+l6K+i5ZWG5oi35L2Z6aKdIC0gR0VUIC92MS9tZXJjaGFudC9iYWxhbmNlXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRCYWxhbmNlKCkge1xyXG4gIHJldHVybiByZXF1ZXN0KCcvdjEvbWVyY2hhbnQvYmFsYW5jZScsICdHRVQnKTtcclxufVxyXG5cclxuLy8g5rWL6K+V6L+e6YCa5oCnXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB0ZXN0Q29ubmVjdGlvbigpIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0Q2FyZEhvbGRlcnMoeyBwYWdlOiAxLCBsaW1pdDogMSB9KTtcclxuICAgIGNvbnNvbGUubG9nKCdbR1NhbGFyeV0g6L+e6YCa5oCn5rWL6K+V5oiQ5YqfOicsIHJlc3VsdCk7XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCByZXN1bHQgfTtcclxuICB9IGNhdGNoIChlcnI6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcignW0dTYWxhcnldIOi/numAmuaAp+a1i+ivleWksei0pTonLCBlcnIubWVzc2FnZSk7XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVyci5tZXNzYWdlIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVLZXlQYWlyKCkge1xyXG4gIGNvbnN0IHsgcHVibGljS2V5LCBwcml2YXRlS2V5IH0gPSBjcnlwdG8uZ2VuZXJhdGVLZXlQYWlyU3luYygncnNhJywge1xyXG4gICAgbW9kdWx1c0xlbmd0aDogNDA5NixcclxuICAgIHB1YmxpY0tleUVuY29kaW5nOiB7IHR5cGU6ICdzcGtpJywgZm9ybWF0OiAncGVtJyB9LFxyXG4gICAgcHJpdmF0ZUtleUVuY29kaW5nOiB7IHR5cGU6ICdwa2NzOCcsIGZvcm1hdDogJ3BlbScgfSxcclxuICB9KTtcclxuICByZXR1cm4geyBwdWJsaWNLZXksIHByaXZhdGVLZXkgfTtcclxufVxyXG4iXSwibmFtZXMiOlsiY3J5cHRvIiwiQVBJX1VSTCIsInByb2Nlc3MiLCJlbnYiLCJHU0FMQVJZX0FQSV9VUkwiLCJBUFBfSUQiLCJHU0FMQVJZX0FQUF9JRCIsIlBSSVZBVEVfS0VZIiwiR1NBTEFSWV9QUklWQVRFX0tFWSIsInJlcGxhY2UiLCJVU0VfTU9DSyIsIkdTQUxBUllfTU9DSyIsIkRFRkFVTFRfQ0FSRF9IT0xERVJfSUQiLCJHU0FMQVJZX0RFRkFVTFRfQ0FSRF9IT0xERVJfSUQiLCJjYWxjdWxhdGVCb2R5SGFzaCIsImJvZHkiLCJoYXNoIiwiY3JlYXRlSGFzaCIsInVwZGF0ZSIsImRpZ2VzdCIsIkJ1ZmZlciIsImZyb20iLCJ0b1N0cmluZyIsImJ1aWxkU2lnblN0cmluZyIsIm1ldGhvZCIsInBhdGgiLCJ0aW1lc3RhbXAiLCJib2R5SGFzaCIsInNpZ25EYXRhIiwiZGF0YSIsInNpZ24iLCJjcmVhdGVTaWduIiwiZW5kIiwic2lnbmF0dXJlIiwiZXJyb3IiLCJjb25zb2xlIiwiRXJyb3IiLCJtb2NrUmVzcG9uc2UiLCJlbmRwb2ludCIsImNhcmRObyIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImluY2x1ZGVzIiwicmVxdWVzdF9pZCIsIkRhdGUiLCJub3ciLCJzdGF0dXMiLCJjYXJkX2lkIiwiY2FyZF9ob2xkZXJfaWQiLCJjYXJkX25vIiwiY3Z2IiwiZXhwaXJ5X2RhdGUiLCJjYXJkcyIsInBhZ2UiLCJsaW1pdCIsInRvdGFsX2NvdW50IiwiYmFsYW5jZSIsInJlcXVlc3QiLCJsb2ciLCJKU09OIiwic3RyaW5naWZ5Iiwic2lnblN0cmluZyIsInRvVXBwZXJDYXNlIiwidXJsIiwiaGVhZGVycyIsIm9wdGlvbnMiLCJyZXNwb25zZSIsImZldGNoIiwicmVzdWx0IiwianNvbiIsIm9rIiwibWVzc2FnZSIsImVycm9yX2NvZGUiLCJnZXRDYXJkSG9sZGVycyIsInBhcmFtcyIsInF1ZXJ5IiwiVVJMU2VhcmNoUGFyYW1zIiwic2V0IiwiZW1haWwiLCJtb2JpbGUiLCJxdWVyeVN0ciIsImNyZWF0ZUNhcmRIb2xkZXIiLCJnZXRDYXJkSG9sZGVyIiwiY2FyZEhvbGRlcklkIiwiYXBwbHlDYXJkIiwiZ2V0Q2FyZEFwcGx5UmVzdWx0IiwicmVxdWVzdElkIiwicXVpY2tBcHBseUNhcmQiLCJzbGljZSIsImhvbGRlcklkIiwicHJvZHVjdF9jb2RlIiwiY3VycmVuY3kiLCJpbml0X2JhbGFuY2UiLCJnZXRDYXJkcyIsImdldENhcmREZXRhaWwiLCJjYXJkSWQiLCJnZXRDYXJkU2Vuc2l0aXZlSW5mbyIsImdldEF2YWlsYWJsZVF1b3RhcyIsImFjY291bnRpbmdDYXJkVHlwZSIsIm1vZGlmeUNhcmRCYWxhbmNlIiwicmVjaGFyZ2VDYXJkIiwiYW1vdW50IiwidHlwZSIsIndpdGhkcmF3RnJvbUNhcmQiLCJnZXRCYWxhbmNlIiwidGVzdENvbm5lY3Rpb24iLCJzdWNjZXNzIiwiZXJyIiwiZ2VuZXJhdGVLZXlQYWlyIiwicHVibGljS2V5IiwicHJpdmF0ZUtleSIsImdlbmVyYXRlS2V5UGFpclN5bmMiLCJtb2R1bHVzTGVuZ3RoIiwicHVibGljS2V5RW5jb2RpbmciLCJmb3JtYXQiLCJwcml2YXRlS2V5RW5jb2RpbmciXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/gsalary.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/prisma.ts":
/*!***************************!*\
  !*** ./src/lib/prisma.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst globalForPrisma = globalThis;\nconst prisma = globalForPrisma.prisma ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\nif (true) globalForPrisma.prisma = prisma;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3ByaXNtYS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBOEM7QUFFOUMsTUFBTUMsa0JBQWtCQztBQUlqQixNQUFNQyxTQUFTRixnQkFBZ0JFLE1BQU0sSUFBSSxJQUFJSCx3REFBWUEsR0FBRztBQUVuRSxJQUFJSSxJQUF5QixFQUFjSCxnQkFBZ0JFLE1BQU0sR0FBR0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jYXJkdmVsYS8uL3NyYy9saWIvcHJpc21hLnRzPzAxZDciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xyXG5cclxuY29uc3QgZ2xvYmFsRm9yUHJpc21hID0gZ2xvYmFsVGhpcyBhcyB1bmtub3duIGFzIHtcclxuICBwcmlzbWE6IFByaXNtYUNsaWVudCB8IHVuZGVmaW5lZDtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBwcmlzbWEgPSBnbG9iYWxGb3JQcmlzbWEucHJpc21hID8/IG5ldyBQcmlzbWFDbGllbnQoKTtcclxuXHJcbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSBnbG9iYWxGb3JQcmlzbWEucHJpc21hID0gcHJpc21hO1xyXG4iXSwibmFtZXMiOlsiUHJpc21hQ2xpZW50IiwiZ2xvYmFsRm9yUHJpc21hIiwiZ2xvYmFsVGhpcyIsInByaXNtYSIsInByb2Nlc3MiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/prisma.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/semver","vendor-chunks/jsonwebtoken","vendor-chunks/lodash.includes","vendor-chunks/jws","vendor-chunks/lodash.once","vendor-chunks/jwa","vendor-chunks/lodash.isinteger","vendor-chunks/ecdsa-sig-formatter","vendor-chunks/lodash.isplainobject","vendor-chunks/ms","vendor-chunks/lodash.isstring","vendor-chunks/lodash.isnumber","vendor-chunks/lodash.isboolean","vendor-chunks/safe-buffer","vendor-chunks/buffer-equal-constant-time","vendor-chunks/bcryptjs"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fuser%2Fcards%2Froute&page=%2Fapi%2Fuser%2Fcards%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fuser%2Fcards%2Froute.ts&appDir=C%3A%5CUsers%5CAdmin%5CDesktop%5Cyeka%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CAdmin%5CDesktop%5Cyeka&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();